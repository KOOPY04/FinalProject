import{r as a,a as J,H as M,M as he,L as B,B as G,S as ne,I as F,T as me}from"./antd-DRHhcGrz.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))s(l);new MutationObserver(l=>{for(const i of l)if(i.type==="childList")for(const h of i.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&s(h)}).observe(document,{childList:!0,subtree:!0});function n(l){const i={};return l.integrity&&(i.integrity=l.integrity),l.referrerPolicy&&(i.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?i.credentials="include":l.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(l){if(l.ep)return;l.ep=!0;const i=n(l);fetch(l.href,i)}})();var se={exports:{}},W={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var pe=a,ge=Symbol.for("react.element"),xe=Symbol.for("react.fragment"),ve=Object.prototype.hasOwnProperty,we=pe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,ye={key:!0,ref:!0,__self:!0,__source:!0};function le(e,t,n){var s,l={},i=null,h=null;n!==void 0&&(i=""+n),t.key!==void 0&&(i=""+t.key),t.ref!==void 0&&(h=t.ref);for(s in t)ve.call(t,s)&&!ye.hasOwnProperty(s)&&(l[s]=t[s]);if(e&&e.defaultProps)for(s in t=e.defaultProps,t)l[s]===void 0&&(l[s]=t[s]);return{$$typeof:ge,type:e,key:i,ref:h,props:l,_owner:we.current}}W.Fragment=xe;W.jsx=le;W.jsxs=le;se.exports=W;var r=se.exports,oe,X=J;oe=X.createRoot,X.hydrateRoot;var ie={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},q=M.createContext&&M.createContext(ie),be=["attr","size","title"];function je(e,t){if(e==null)return{};var n=Ne(e,t),s,l;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(l=0;l<i.length;l++)s=i[l],!(t.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(e,s)&&(n[s]=e[s])}return n}function Ne(e,t){if(e==null)return{};var n={};for(var s in e)if(Object.prototype.hasOwnProperty.call(e,s)){if(t.indexOf(s)>=0)continue;n[s]=e[s]}return n}function Z(){return Z=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},Z.apply(this,arguments)}function Q(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),n.push.apply(n,s)}return n}function K(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Q(Object(n),!0).forEach(function(s){Se(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Q(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function Se(e,t,n){return t=Ce(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Ce(e){var t=Oe(e,"string");return typeof t=="symbol"?t:t+""}function Oe(e,t){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function ae(e){return e&&e.map((t,n)=>M.createElement(t.tag,K({key:n},t.attr),ae(t.child)))}function P(e){return t=>M.createElement(ke,Z({attr:K({},e.attr)},t),ae(e.child))}function ke(e){var t=n=>{var{attr:s,size:l,title:i}=e,h=je(e,be),x=l||n.size||"1em",p;return n.className&&(p=n.className),e.className&&(p=(p?p+" ":"")+e.className),M.createElement("svg",Z({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},n.attr,s,h,{className:p,style:K(K({color:e.color||n.color},n.style),e.style),height:x,width:x,xmlns:"http://www.w3.org/2000/svg"}),i&&M.createElement("title",null,i),e.children)};return q!==void 0?M.createElement(q.Consumer,null,n=>t(n)):t(ie)}function Ee(e){return P({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M16 16V12L21 17L16 22V18H4V16H16ZM8 2V5.999L20 6V8H8V12L3 7L8 2Z"},child:[]}]})(e)}function Le(e){return P({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M4 3H20C20.5523 3 21 3.44772 21 4V11H3V4C3 3.44772 3.44772 3 4 3ZM3 13H21V20C21 20.5523 20.5523 21 20 21H4C3.44772 21 3 20.5523 3 20V13ZM7 16V18H10V16H7ZM7 6V8H10V6H7Z"},child:[]}]})(e)}function Me(e){return P({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M3 4H21V6H3V4ZM3 19H21V21H3V19ZM11 14H21V16H11V14ZM11 9H21V11H11V9ZM3 12.5L7 9V16L3 12.5Z"},child:[]}]})(e)}function _e(e){return P({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M3 4H21V6H3V4ZM3 19H21V21H3V19ZM11 14H21V16H11V14ZM11 9H21V11H11V9ZM7 12.5L3 16V9L7 12.5Z"},child:[]}]})(e)}function Pe(e){return P({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M12 22C6.47715 22 2 17.5228 2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22ZM12 9.5C12.8284 9.5 13.5 8.82843 13.5 8C13.5 7.17157 12.8284 6.5 12 6.5C11.1716 6.5 10.5 7.17157 10.5 8C10.5 8.82843 11.1716 9.5 12 9.5ZM14 15H13V10.5H10V12.5H11V15H10V17H14V15Z"},child:[]}]})(e)}function Ve(e){return P({tag:"svg",attr:{version:"1.1",viewBox:"0 0 17 17"},child:[{tag:"g",attr:{},child:[]},{tag:"path",attr:{d:"M6 8h-6v-6h1v4.109c1.013-3.193 4.036-5.484 7.5-5.484 3.506 0 6.621 2.36 7.574 5.739l-0.963 0.271c-0.832-2.95-3.551-5.011-6.611-5.011-3.226 0.001-6.016 2.276-6.708 5.376h4.208v1zM11 9v1h4.208c-0.693 3.101-3.479 5.375-6.708 5.375-3.062 0-5.78-2.061-6.611-5.011l-0.963 0.271c0.952 3.379 4.067 5.739 7.574 5.739 3.459 0 6.475-2.28 7.5-5.482v4.108h1v-6h-6z"},child:[]}]})(e)}function He(e){return P({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 16C123.45 16 16 123.45 16 256s107.45 240 240 240 240-107.45 240-240S388.55 16 256 16zm0 60c99.41 0 180 80.59 180 180s-80.59 180-180 180S76 355.41 76 256 156.59 76 256 76zm-80.625 60c-.97-.005-2.006.112-3.063.313v-.032c-18.297 3.436-45.264 34.743-33.375 46.626l73.157 73.125-73.156 73.126c-14.63 14.625 29.275 58.534 43.906 43.906L256 299.906l73.156 73.156c14.63 14.628 58.537-29.28 43.906-43.906l-73.156-73.125 73.156-73.124c14.63-14.625-29.275-58.5-43.906-43.875L256 212.157l-73.156-73.125c-2.06-2.046-4.56-3.015-7.47-3.03z"},child:[]}]})(e)}function Re(e){return P({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M20 16l-4 4"},child:[]},{tag:"path",attr:{d:"M7 12l5 5l-1.5 1.5a3.536 3.536 0 1 1 -5 -5l1.5 -1.5z"},child:[]},{tag:"path",attr:{d:"M17 12l-5 -5l1.5 -1.5a3.536 3.536 0 1 1 5 5l-1.5 1.5z"},child:[]},{tag:"path",attr:{d:"M3 21l2.5 -2.5"},child:[]},{tag:"path",attr:{d:"M18.5 5.5l2.5 -2.5"},child:[]},{tag:"path",attr:{d:"M10 11l-2 2"},child:[]},{tag:"path",attr:{d:"M13 14l-2 2"},child:[]},{tag:"path",attr:{d:"M16 16l4 4"},child:[]}]})(e)}function Te(e){return P({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M7 12l5 5l-1.5 1.5a3.536 3.536 0 1 1 -5 -5l1.5 -1.5z"},child:[]},{tag:"path",attr:{d:"M17 12l-5 -5l1.5 -1.5a3.536 3.536 0 1 1 5 5l-1.5 1.5z"},child:[]},{tag:"path",attr:{d:"M3 21l2.5 -2.5"},child:[]},{tag:"path",attr:{d:"M18.5 5.5l2.5 -2.5"},child:[]},{tag:"path",attr:{d:"M10 11l-2 2"},child:[]},{tag:"path",attr:{d:"M13 14l-2 2"},child:[]}]})(e)}const Ie=({toggleConnectStatusOpen:e,toggleLocalFileListOpen:t,toggleSendStatusOpen:n,toggleRemoteFileListOpen:s})=>{const[l,i]=a.useState(!1),[h,x]=a.useState(()=>{const f=localStorage.getItem("dataList");return f?JSON.parse(f):[]}),[p,E]=a.useState(""),[d,y]=a.useState(""),[S,O]=a.useState(""),[w,k]=a.useState(""),[g,b]=a.useState(""),[L,C]=a.useState(!1),[_,V]=a.useState(!1);a.useEffect(()=>{localStorage.setItem("dataList",JSON.stringify(h))},[h]);const c=()=>{if(p.trim()&&g.trim()&&S.trim()&&w.trim()){const f=h.some(m=>m.host===p);x(f?h.map(m=>m.name===d?{host:p,user:g,password:S,port:w}:m):[...h,{name:d.trim(),host:p.trim(),user:g,password:S,port:w}]),E(""),b(""),O(""),k(""),y("")}},o=f=>{const m=f.currentTarget.getAttribute("id");switch(console.log(`Button clicked: ${m}`),m){case"1":e();break;case"2":t();break;case"3":s();break;case"4":n();break}},u=f=>{E(f.host),y(f.name),b(f.user),O(f.password),k(f.port),V(!0),i(!0)},v=f=>{console.log(`Connecting to ${f.host}`)},R=f=>{x(h.filter(m=>m.host!==f.host))},H=()=>{E(""),b(""),O(""),k(""),y(""),V(!1),i(!1)};return r.jsxs("div",{className:"flex flex-row items-center space-x-5 bg-gray-500 border border-white",children:[r.jsxs("div",{className:"flex items-center",children:[r.jsx("button",{title:"站台管理員",onClick:()=>i(!0),children:r.jsx(Le,{className:"w-12 h-12 lg:w-20 lg:h-20 md:w-16 md:h-16",color:"#87A2FF"})}),r.jsx(he,{title:"保存資料管理",open:l,onCancel:H,cancelText:"關閉",okText:d?"保存":"新增",onOk:c,destroyOnClose:!0,children:r.jsxs("div",{className:"flex flex-row w-full",children:[r.jsx("div",{className:"w-1/2 text-center flex1 h-[250px] overflow-auto",children:r.jsx(B,{dataSource:h,header:r.jsx("div",{children:"站台列表"}),renderItem:(f,m)=>r.jsxs(B.Item,{onClick:()=>u(f),className:"w-full text-lg cursor-pointer",children:[r.jsx("p",{children:`${f.name}`}),r.jsxs("div",{children:[r.jsx(G,{className:"ml-2",onClick:j=>{j.stopPropagation(),R(f)},children:"刪除"}),r.jsx(G,{className:"ml-2",onClick:j=>{j.stopPropagation(),v(f)},children:"連線"})]})]},m)})}),r.jsx("div",{className:"w-1/2 text-center flex1",children:r.jsxs(ne,{direction:"vertical",children:[r.jsx(F,{placeholder:"名稱",value:d,disabled:_,onChange:f=>y(f.target.value)}),r.jsx(F,{placeholder:"主機地址",value:p,defaultValue:"127.0.0.1",onChange:f=>E(f.target.value)}),r.jsx(F,{placeholder:"使用者帳號",value:g,onChange:f=>b(f.target.value)}),r.jsx(F.Password,{placeholder:"使用者密碼",visibilityToggle:{visible:L,onVisibleChange:C},value:S,onChange:f=>O(f.target.value)}),r.jsx(F,{placeholder:"連接埠",value:w,defaultValue:"50051",onChange:f=>k(f.target.value)})]})})]})})]}),r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx("button",{title:"連線紀錄",id:"1",onClick:o,children:r.jsx(Pe,{className:"w-12 h-12 lg:w-20 lg:h-20 md:w-16 md:h-16",color:"#ffc800"})}),r.jsx("button",{title:"切換本地目錄樹",id:"2",onClick:o,children:r.jsx(Me,{className:"w-12 h-12 lg:w-20 lg:h-20 md:w-16 md:h-16",color:"#7acf6a"})}),r.jsx("button",{title:"切換遠端目錄樹",id:"3",onClick:o,children:r.jsx(_e,{className:"w-12 h-12 lg:w-20 lg:h-20 md:w-16 md:h-16",color:"#87A2FF"})}),r.jsx("button",{title:"檔案傳輸過程",id:"4",onClick:o,children:r.jsx(Ee,{className:"w-12 h-12 lg:w-20 lg:h-20 md:w-16 md:h-16",color:"#5ba4a4"})})]}),r.jsxs("div",{className:"flex items-center",children:[r.jsx("button",{title:"重新整理檔案及資料夾",onClick:o,children:r.jsx(Ve,{className:"h-9 w-9 lg:w-16 lg:h-16 md:w-12 md:h-12",color:"#99ff99"})}),r.jsx("button",{title:"取消檔案動作",className:"ml-2 lg:ml-4 md:ml-3",onClick:o,children:r.jsx(He,{className:"w-10 h-10 lg:w-20 lg:h-20 md:w-16 md:h-16",color:"#cc0000"})}),r.jsx("button",{title:"連接伺服器",className:"ml-1 md:ml-2",onClick:o,children:r.jsx(Te,{className:"w-10 h-10 lg:w-20 lg:h-20 md:w-16 md:h-16",color:"#99ff33"})}),r.jsx("button",{title:"中斷伺服器",className:"-ml-1 md:-ml-2",onClick:o,children:r.jsx(Re,{className:"w-10 h-10 lg:w-20 lg:h-20 md:w-16 md:h-16",color:"#ff6600"})})]})]})},Fe=({setMessage:e})=>{const[t,n]=a.useState("127.0.0.1"),[s,l]=a.useState(""),[i,h]=a.useState(""),[x,p]=a.useState("50051"),E=async()=>{if(window.pywebview){if(t===""||x===""||s===""||i===""){e("請輸入完整資訊");return}const d=await window.pywebview.api.login(t,x,s,i),y=JSON.parse(d);"error"in y?e(y.error):e(y.message)}else e("請在pywebview環境下使用")};return r.jsxs("div",{className:"flex flex-wrap items-center justify-start p-2 bg-gray-500 border border-white gap-7",children:[r.jsxs("div",{className:"flex items-center",children:[r.jsx("label",{htmlFor:"host",className:"mr-1 text-sm text-white whitespace-nowrap",children:"主機(H):"}),r.jsx("input",{type:"text",id:"host",className:"px-2 py-1 text-sm border border-gray-300 rounded w-28 focus:outline-none focus:ring-1 focus:ring-cyan-500",value:t,onChange:d=>n(d.target.value)})]}),r.jsxs("div",{className:"flex items-center",children:[r.jsx("label",{htmlFor:"username",className:"mr-1 text-sm text-white whitespace-nowrap",children:"使用者名稱(U):"}),r.jsx("input",{type:"text",id:"username",className:"px-2 py-1 text-sm border border-gray-300 rounded w-28 focus:outline-none focus:ring-1 focus:ring-cyan-500",value:s,onChange:d=>l(d.target.value)})]}),r.jsxs("div",{className:"flex items-center",children:[r.jsx("label",{htmlFor:"password",className:"mr-1 text-sm text-white whitespace-nowrap",children:"密碼(W):"}),r.jsx("input",{type:"password",id:"password",className:"px-2 py-1 text-sm border border-gray-300 rounded w-28 focus:outline-none focus:ring-1 focus:ring-cyan-500",value:i,onChange:d=>h(d.target.value)})]}),r.jsxs("div",{className:"flex items-center",children:[r.jsx("label",{htmlFor:"port",className:"mr-1 text-sm text-white whitespace-nowrap",children:"連接埠(P):"}),r.jsx("input",{type:"number",id:"port",className:"w-20 px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-cyan-500",value:x,onChange:d=>p(d.target.value)})]}),r.jsx("button",{className:"px-3 py-1 text-sm text-white bg-blue-600 rounded hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500",onClick:E,children:"快速連線(Q)"})]})},De=({message:e})=>{const[t,n]=a.useState([]),s=a.useRef(null);return a.useEffect(()=>{n(l=>[...l,e])},[e]),a.useEffect(()=>{s.current&&(s.current.scrollTop=s.current.scrollHeight)},[t]),r.jsx("div",{ref:s,className:"w-full h-full p-2 overflow-auto bg-gray-500 border",style:{maxHeight:"400px"},children:r.jsx(ne,{direction:"vertical",children:r.jsx(B,{dataSource:t,renderItem:(l,i)=>r.jsx(B.Item,{style:{paddingTop:"2px",paddingBottom:"2px"},children:r.jsx("div",{className:"flex items-center w-full h-full px-2 text-white",children:l})},i)})})})};function ce(e){var t,n,s="";if(typeof e=="string"||typeof e=="number")s+=e;else if(typeof e=="object")if(Array.isArray(e))for(t=0;t<e.length;t++)e[t]&&(n=ce(e[t]))&&(s&&(s+=" "),s+=n);else for(t in e)e[t]&&(s&&(s+=" "),s+=t);return s}function z(){for(var e,t,n=0,s="";n<arguments.length;)(e=arguments[n++])&&(t=ce(e))&&(s&&(s+=" "),s+=t);return s}var de=a.createContext({}),$e=()=>a.useContext(de),Ae=e=>M.createElement(de.Provider,{...e});function ze(){let e=new Map;return{on(t,n){return e.has(t)?e.get(t).add(n):e.set(t,new Set([n])),this},off(t,n){return e.has(t)&&e.get(t).delete(n),this},emit(t,n){return e.has(t)&&e.get(t).forEach(s=>{s(n)}),this}}}var U=ze(),Be=()=>a.useRef(new Map).current,Ze=()=>{},ee=["resize","contextmenu","click","scroll","blur"],Y={show({event:e,id:t,props:n,position:s}){e.preventDefault&&e.preventDefault(),U.emit(0).emit(t,{event:e.nativeEvent||e,props:n,position:s})},hideAll(){U.emit(0)}};function Ke(){let e=new Map,t,n,s,l,i=!1;function h(g){l=Array.from(g.values()),t=-1,s=!0}function x(){l[t].node.focus()}let p=()=>t>=0&&l[t].isSubmenu,E=()=>Array.from(l[t].submenuRefTracker.values());function d(){return t===-1?(y(),!1):!0}function y(){t+1<l.length?t++:t+1===l.length&&(t=0),i&&w(),x()}function S(){t===-1||t===0?t=l.length-1:t-1<l.length&&t--,i&&w(),x()}function O(){if(d()&&p()){let g=E(),{node:b,setSubmenuPosition:L}=l[t];return e.set(b,{isRoot:s,focusedIndex:t,parentNode:n||b,items:l}),L(),b.classList.add("contexify_submenu-isOpen"),n=b,g.length>0?(t=0,l=g):i=!0,s=!1,x(),!0}return!1}function w(){if(d()&&!s){let g=e.get(n);n.classList.remove("contexify_submenu-isOpen"),l=g.items,n=g.parentNode,g.isRoot&&(s=!0,e.clear()),i||(t=g.focusedIndex,x())}}function k(g){function b(L){for(let C of L)C.isSubmenu&&C.submenuRefTracker&&b(Array.from(C.submenuRefTracker.values())),C.keyMatcher&&C.keyMatcher(g)}b(l)}return{init:h,moveDown:y,moveUp:S,openSubmenu:O,closeSubmenu:w,matchKeys:k}}function D(e){return typeof e=="function"}function te(e){return typeof e=="string"}function Ue(e,t){return a.Children.map(a.Children.toArray(e).filter(Boolean),n=>a.cloneElement(n,t))}function We(e){let t={x:e.clientX,y:e.clientY},n=e.changedTouches;return n&&(t.x=n[0].clientX,t.y=n[0].clientY),(!t.x||t.x<0)&&(t.x=0),(!t.y||t.y<0)&&(t.y=0),t}function re(e,t){return D(e)?e(t):e}function Je(e,t){return{...e,...D(t)?t(e):t}}var ue=({id:e,theme:t,style:n,className:s,children:l,animation:i="fade",preventDefaultOnKeydown:h=!0,disableBoundariesCheck:x=!1,onVisibilityChange:p,...E})=>{let[d,y]=a.useReducer(Je,{x:0,y:0,visible:!1,triggerEvent:{},propsFromTrigger:null,willLeave:!1}),S=a.useRef(null),O=Be(),[w]=a.useState(()=>Ke()),k=a.useRef(),g=a.useRef();a.useEffect(()=>(U.on(e,L).on(0,C),()=>{U.off(e,L).off(0,C)}),[e,i,x]),a.useEffect(()=>{d.visible?w.init(O):O.clear()},[d.visible,w,O]);function b(m,j){if(S.current&&!x){let{innerWidth:N,innerHeight:I}=window,{offsetWidth:$,offsetHeight:A}=S.current;m+$>N&&(m-=m+$-N),j+A>I&&(j-=j+A-I)}return{x:m,y:j}}a.useEffect(()=>{d.visible&&y(b(d.x,d.y))},[d.visible]),a.useEffect(()=>{function m(N){h&&N.preventDefault()}function j(N){switch(N.key){case"Enter":case" ":w.openSubmenu()||C();break;case"Escape":C();break;case"ArrowUp":m(N),w.moveUp();break;case"ArrowDown":m(N),w.moveDown();break;case"ArrowRight":m(N),w.openSubmenu();break;case"ArrowLeft":m(N),w.closeSubmenu();break;default:w.matchKeys(N);break}}if(d.visible){window.addEventListener("keydown",j);for(let N of ee)window.addEventListener(N,C)}return()=>{window.removeEventListener("keydown",j);for(let N of ee)window.removeEventListener(N,C)}},[d.visible,w,h]);function L({event:m,props:j,position:N}){m.stopPropagation();let I=N||We(m),{x:$,y:A}=b(I.x,I.y);J.flushSync(()=>{y({visible:!0,willLeave:!1,x:$,y:A,triggerEvent:m,propsFromTrigger:j})}),clearTimeout(g.current),!k.current&&D(p)&&(p(!0),k.current=!0)}function C(m){m!=null&&(m.button===2||m.ctrlKey)&&m.type!=="contextmenu"||(i&&(te(i)||"exit"in i&&i.exit)?y(j=>({willLeave:j.visible})):y(j=>({visible:j.visible?!1:j.visible})),g.current=setTimeout(()=>{D(p)&&p(!1),k.current=!1}))}function _(){d.willLeave&&d.visible&&J.flushSync(()=>y({visible:!1,willLeave:!1}))}function V(){return te(i)?z({[`contexify_willEnter-${i}`]:c&&!H,[`contexify_willLeave-${i} contexify_willLeave-'disabled'`]:c&&H}):i&&"enter"in i&&"exit"in i?z({[`contexify_willEnter-${i.enter}`]:i.enter&&c&&!H,[`contexify_willLeave-${i.exit} contexify_willLeave-'disabled'`]:i.exit&&c&&H}):null}let{visible:c,triggerEvent:o,propsFromTrigger:u,x:v,y:R,willLeave:H}=d,f=z("contexify",s,{[`contexify_theme-${t}`]:t},V());return M.createElement(Ae,{value:O},c&&M.createElement("div",{...E,className:f,onAnimationEnd:_,style:{...n,left:v,top:R,opacity:1},ref:S,role:"menu"},Ue(l,{propsFromTrigger:u,triggerEvent:o})))},T=({id:e,children:t,className:n,style:s,triggerEvent:l,data:i,propsFromTrigger:h,keyMatcher:x,onClick:p=Ze,disabled:E=!1,hidden:d=!1,closeOnClick:y=!0,handlerEvent:S="onClick",...O})=>{let w=a.useRef(),k=$e(),g={id:e,data:i,triggerEvent:l,props:h},b=re(E,g),L=re(d,g);function C(o){g.event=o,o.stopPropagation(),b||(y?_():p(g))}function _(){let o=w.current;o.focus(),o.addEventListener("animationend",()=>setTimeout(Y.hideAll),{once:!0}),o.classList.add("contexify_item-feedback"),p(g)}function V(o){o&&!b&&(w.current=o,k.set(o,{node:o,isSubmenu:!1,keyMatcher:!b&&D(x)&&(u=>{x(u)&&(u.stopPropagation(),u.preventDefault(),g.event=u,_())})}))}function c(o){(o.key==="Enter"||o.key===" ")&&(o.stopPropagation(),g.event=o,_())}return L?null:M.createElement("div",{...O,[S]:C,className:z("contexify_item",n,{"contexify_item-disabled":b}),style:s,onKeyDown:c,ref:V,tabIndex:-1,role:"menuitem","aria-disabled":b},M.createElement("div",{className:"contexify_itemContent"},t))};const{DirectoryTree:Ye}=me,Ge=e=>({fileMenuId:`file_menu_${e?"local":"remote"}`,folderMenuId:`folder_menu_${e?"local":"remote"}`}),Xe=({nodeKey:e,onOpenFolder:t,nodeTitle:n,isLocal:s,menuId:l})=>r.jsxs(ue,{id:l,children:[r.jsx(T,{onClick:()=>t(e),children:"開啟資料夾"}),r.jsx(T,{onClick:()=>console.log(s?"新增檔案":"新增遠端檔案"),children:s?"新增檔案":"新增遠端檔案"}),r.jsx(T,{onClick:()=>console.log("刪除資料夾"),disabled:n==="根目錄"||n==="遠端根目錄"||n==="downloads"||n==="uploads",children:"刪除資料夾"})]}),fe=({initialTreeData:e=[{title:"根目錄",key:"root",children:void 0}],isLocal:t,onNodeSelect:n,setSendStatus:s})=>{const[l,i]=a.useState(e),[h,x]=a.useState([]),[p,E]=a.useState(""),[d,y]=a.useState(null),S=Ge(t);a.useEffect(()=>{x(t?["localStorage"]:["remoteStorage"])},[t]);const O=async(c,o)=>{const u=o.key,v=await window.pywebview.api.get_file_size(u),R=JSON.parse(v);if(R.error){console.error(R.error);return}const H=`${R.size}`,f=c==="上傳檔案"?"上傳":"下載",m=t?"":`/remote/path/${o.title}`;s(j=>[...j,{fileName:String(o.title),fileSize:H,direction:f,remotePath:m,status:"傳送中"}]),c==="上傳檔案"?await window.pywebview.api.get_local_children(u):c==="下載檔案"&&await window.pywebview.api.get_server_children(u),s(j=>j.map(N=>N.fileName===String(o.title)?{...N,status:"完成"}:N))},w=({isLocal:c,menuId:o})=>r.jsxs(ue,{id:o,children:[r.jsx(T,{onClick:()=>console.log("開啟檔案"),children:"開啟檔案"}),r.jsx(T,{onClick:()=>console.log("刪除檔案"),children:"刪除檔案"}),r.jsx(T,{onClick:u=>O(c?"上傳檔案":"下載檔案",u.props.node),children:c?"上傳檔案":"下載檔案"})]}),k=(c,o,u)=>c.map(v=>v.key===o?{...v,children:u}:v.children?{...v,children:k(v.children,o,u)}:v),g=async c=>{try{const o=await window.pywebview.api.get_local_children(c),u=JSON.parse(o);return u.error?(console.error("Error:",u.error),[]):!Array.isArray(u)||u.length===0?[{title:"無檔案",key:`${c}-empty`,isLeaf:!0}]:u.map(v=>({title:v.title,key:v.key,isLeaf:v.isLeaf,children:v.children||void 0}))}catch(o){return console.error("Failed to fetch local children:",o),[]}},b=async c=>{try{const o=await window.pywebview.api.get_server_children(c),u=JSON.parse(o);return u.error?(console.error("Error:",u.error),[]):!Array.isArray(u)||u.length===0?[{title:"無檔案",key:`${c}-empty`,isLeaf:!0}]:u.map(v=>({title:v.title,key:v.key,isLeaf:v.isLeaf,children:v.children||void 0}))}catch(o){return console.error("Failed to fetch remote children:",o),[]}},L=async({key:c,children:o})=>{if(o)return Promise.resolve();const u=t?await g(c):await b(c);i(v=>k(v,c,u))},C=(c,o)=>{c.preventDefault();const u=typeof o.title=="string"?o.title:String(o.title);E(u),y(o.key),o.isLeaf?Y.show({id:S.fileMenuId,event:c,props:{node:o}}):Y.show({id:S.folderMenuId,event:c,props:{node:o}})},_=(c,o)=>{if(n&&c.length>0){const u=c[0],v=o.node;n(u,v)}},V=c=>{x(o=>[...o,c])};return r.jsxs(r.Fragment,{children:[r.jsx(Ye,{loadData:L,treeData:l,onSelect:_,expandedKeys:h,onRightClick:({event:c,node:o})=>C(c,o),onExpand:c=>x(c)}),r.jsx(w,{isLocal:t,menuId:S.fileMenuId}),d!==null&&r.jsx(Xe,{nodeKey:d,onOpenFolder:V,nodeTitle:p,isLocal:t,menuId:S.folderMenuId})]})},qe=(e,t)=>{console.log("Selected node key:",e)},Qe=({setSendStatus:e})=>{const t=[{title:"根目錄",key:"localStorage",children:void 0}];return r.jsx("div",{className:"h-full px-2 py-1 bg-gray-500 border-2 rounded",children:r.jsx(fe,{onNodeSelect:qe,initialTreeData:t,isLocal:!0,setSendStatus:e})})},et=(e,t)=>{console.log("Selected remote node key:",e)},tt=({setSendStatus:e})=>{const t=[{title:"遠端根目錄",key:"remoteStorage",children:void 0}];return r.jsx("div",{className:"h-full px-2 py-1 bg-gray-500 border-2 rounded",children:r.jsx(fe,{onNodeSelect:et,initialTreeData:t,isLocal:!1,setSendStatus:e})})},rt=({setSendStatus:e,localOpen:t,remoteOpen:n})=>r.jsxs("div",{className:"flex flex-row w-full h-full gap-2",children:[t&&r.jsx("div",{className:"flex-1",children:r.jsx(Qe,{setSendStatus:e})}),n&&r.jsx("div",{className:"flex-1",children:r.jsx(tt,{setSendStatus:e})})]}),nt=({sendStatus:e})=>(console.log(e),r.jsxs("div",{className:"box-border w-full h-full p-2 pb-4 bg-gray-500 border rounded",children:[r.jsxs("div",{className:"box-border grid grid-cols-5 gap-1 p-2 text-white bg-gray-600 border rounded",children:[r.jsx("div",{className:"col-span-1 truncate",children:"檔案名稱"}),r.jsx("div",{className:"col-span-1 truncate",children:"檔案大小/本地檔案"}),r.jsx("div",{className:"col-span-1 truncate",children:"方向"}),r.jsx("div",{className:"col-span-1 truncate",children:"遠端檔案"}),r.jsx("div",{className:"col-span-1 truncate",children:"狀態"})]}),r.jsx("div",{className:"overflow-y-auto",style:{maxHeight:"3.5rem"},children:e.map((t,n)=>r.jsxs("div",{className:`grid grid-cols-5 gap-1 p-2 ${n%2===0?"bg-gray-400":"bg-gray-300"} border rounded box-border`,children:[r.jsx("div",{className:"col-span-1 truncate",children:t.fileName}),r.jsxs("div",{className:"col-span-1 truncate",children:[t.fileSize," "]}),r.jsx("div",{className:"col-span-1 truncate",children:t.direction}),r.jsx("div",{className:"col-span-1 truncate",children:t.remotePath}),r.jsx("div",{className:"col-span-1 truncate",children:t.status})]},n))})]})),st=()=>{const[e,t]=a.useState(""),[n,s]=a.useState([]),[l,i]=a.useState(!0),[h,x]=a.useState(!0),[p,E]=a.useState(!0),[d,y]=a.useState(!0),S=()=>i(!l),O=()=>x(!h),w=()=>y(!d),k=()=>E(!p);return console.log(h,p),r.jsxs("div",{className:"grid grid-rows-[auto_auto_2fr_auto] h-screen min-w-full gap-1 p-2 bg-gray-700",children:[r.jsxs("div",{children:[r.jsx(Ie,{toggleConnectStatusOpen:S,toggleLocalFileListOpen:O,toggleRemoteFileListOpen:k,toggleSendStatusOpen:w}),r.jsx(Fe,{setMessage:t})]}),l&&r.jsx("div",{className:"h-28",children:r.jsx(De,{message:e})}),(h||p)&&r.jsx("div",{className:"grid grid-cols-1 gap-1",children:r.jsx(rt,{setSendStatus:s,localOpen:h,remoteOpen:p})}),d&&r.jsx("div",{className:"h-28",children:r.jsx(nt,{sendStatus:n})})]})};oe(document.getElementById("root")).render(r.jsx(a.StrictMode,{children:r.jsx(st,{})}));
