import{r as i,a as ue,H as V,M as je,L as se,B as me,S as Se,I as G,b as Ne,T as Ae,E as $e}from"./antd-CgqAf7up.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const l of o)if(l.type==="childList")for(const f of l.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&s(f)}).observe(document,{childList:!0,subtree:!0});function n(o){const l={};return o.integrity&&(l.integrity=o.integrity),o.referrerPolicy&&(l.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?l.credentials="include":o.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function s(o){if(o.ep)return;o.ep=!0;const l=n(o);fetch(o.href,l)}})();var Ce={exports:{}},ie={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ze=i,Be=Symbol.for("react.element"),Ke=Symbol.for("react.fragment"),Ze=Object.prototype.hasOwnProperty,Je=ze.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Ue={key:!0,ref:!0,__self:!0,__source:!0};function Oe(e,t,n){var s,o={},l=null,f=null;n!==void 0&&(l=""+n),t.key!==void 0&&(l=""+t.key),t.ref!==void 0&&(f=t.ref);for(s in t)Ze.call(t,s)&&!Ue.hasOwnProperty(s)&&(o[s]=t[s]);if(e&&e.defaultProps)for(s in t=e.defaultProps,t)o[s]===void 0&&(o[s]=t[s]);return{$$typeof:Be,type:e,key:l,ref:f,props:o,_owner:Je.current}}ie.Fragment=Ke;ie.jsx=Oe;ie.jsxs=Oe;Ce.exports=ie;var r=Ce.exports,ke,ge=ue;ke=ge.createRoot,ge.hydrateRoot;var Ee={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},ve=V.createContext&&V.createContext(Ee),We=["attr","size","title"];function Ge(e,t){if(e==null)return{};var n=Ye(e,t),s,o;if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(o=0;o<l.length;o++)s=l[o],!(t.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(e,s)&&(n[s]=e[s])}return n}function Ye(e,t){if(e==null)return{};var n={};for(var s in e)if(Object.prototype.hasOwnProperty.call(e,s)){if(t.indexOf(s)>=0)continue;n[s]=e[s]}return n}function oe(){return oe=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},oe.apply(this,arguments)}function we(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,s)}return n}function le(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?we(Object(n),!0).forEach(function(s){Xe(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):we(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function Xe(e,t,n){return t=qe(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function qe(e){var t=Qe(e,"string");return typeof t=="symbol"?t:t+""}function Qe(e,t){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function _e(e){return e&&e.map((t,n)=>V.createElement(t.tag,le({key:n},t.attr),_e(t.child)))}function I(e){return t=>V.createElement(et,oe({attr:le({},e.attr)},t),_e(e.child))}function et(e){var t=n=>{var{attr:s,size:o,title:l}=e,f=Ge(e,We),b=o||n.size||"1em",w;return n.className&&(w=n.className),e.className&&(w=(w?w+" ":"")+e.className),V.createElement("svg",oe({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},n.attr,s,f,{className:w,style:le(le({color:e.color||n.color},n.style),e.style),height:b,width:b,xmlns:"http://www.w3.org/2000/svg"}),l&&V.createElement("title",null,l),e.children)};return ve!==void 0?V.createElement(ve.Consumer,null,n=>t(n)):t(Ee)}function tt(e){return I({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M16 16V12L21 17L16 22V18H4V16H16ZM8 2V5.999L20 6V8H8V12L3 7L8 2Z"},child:[]}]})(e)}function rt(e){return I({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M4 3H20C20.5523 3 21 3.44772 21 4V11H3V4C3 3.44772 3.44772 3 4 3ZM3 13H21V20C21 20.5523 20.5523 21 20 21H4C3.44772 21 3 20.5523 3 20V13ZM7 16V18H10V16H7ZM7 6V8H10V6H7Z"},child:[]}]})(e)}function nt(e){return I({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M3 4H21V6H3V4ZM3 19H21V21H3V19ZM11 14H21V16H11V14ZM11 9H21V11H11V9ZM3 12.5L7 9V16L3 12.5Z"},child:[]}]})(e)}function st(e){return I({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M3 4H21V6H3V4ZM3 19H21V21H3V19ZM11 14H21V16H11V14ZM11 9H21V11H11V9ZM7 12.5L3 16V9L7 12.5Z"},child:[]}]})(e)}function ot(e){return I({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M12 22C6.47715 22 2 17.5228 2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22ZM12 9.5C12.8284 9.5 13.5 8.82843 13.5 8C13.5 7.17157 12.8284 6.5 12 6.5C11.1716 6.5 10.5 7.17157 10.5 8C10.5 8.82843 11.1716 9.5 12 9.5ZM14 15H13V10.5H10V12.5H11V15H10V17H14V15Z"},child:[]}]})(e)}function lt(e){return I({tag:"svg",attr:{version:"1.1",viewBox:"0 0 17 17"},child:[{tag:"g",attr:{},child:[]},{tag:"path",attr:{d:"M6 8h-6v-6h1v4.109c1.013-3.193 4.036-5.484 7.5-5.484 3.506 0 6.621 2.36 7.574 5.739l-0.963 0.271c-0.832-2.95-3.551-5.011-6.611-5.011-3.226 0.001-6.016 2.276-6.708 5.376h4.208v1zM11 9v1h4.208c-0.693 3.101-3.479 5.375-6.708 5.375-3.062 0-5.78-2.061-6.611-5.011l-0.963 0.271c0.952 3.379 4.067 5.739 7.574 5.739 3.459 0 6.475-2.28 7.5-5.482v4.108h1v-6h-6z"},child:[]}]})(e)}function at(e){return I({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 16C123.45 16 16 123.45 16 256s107.45 240 240 240 240-107.45 240-240S388.55 16 256 16zm0 60c99.41 0 180 80.59 180 180s-80.59 180-180 180S76 355.41 76 256 156.59 76 256 76zm-80.625 60c-.97-.005-2.006.112-3.063.313v-.032c-18.297 3.436-45.264 34.743-33.375 46.626l73.157 73.125-73.156 73.126c-14.63 14.625 29.275 58.534 43.906 43.906L256 299.906l73.156 73.156c14.63 14.628 58.537-29.28 43.906-43.906l-73.156-73.125 73.156-73.124c14.63-14.625-29.275-58.5-43.906-43.875L256 212.157l-73.156-73.125c-2.06-2.046-4.56-3.015-7.47-3.03z"},child:[]}]})(e)}function it(e){return I({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M20 16l-4 4"},child:[]},{tag:"path",attr:{d:"M7 12l5 5l-1.5 1.5a3.536 3.536 0 1 1 -5 -5l1.5 -1.5z"},child:[]},{tag:"path",attr:{d:"M17 12l-5 -5l1.5 -1.5a3.536 3.536 0 1 1 5 5l-1.5 1.5z"},child:[]},{tag:"path",attr:{d:"M3 21l2.5 -2.5"},child:[]},{tag:"path",attr:{d:"M18.5 5.5l2.5 -2.5"},child:[]},{tag:"path",attr:{d:"M10 11l-2 2"},child:[]},{tag:"path",attr:{d:"M13 14l-2 2"},child:[]},{tag:"path",attr:{d:"M16 16l4 4"},child:[]}]})(e)}function ct(e){return I({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M7 12l5 5l-1.5 1.5a3.536 3.536 0 1 1 -5 -5l1.5 -1.5z"},child:[]},{tag:"path",attr:{d:"M17 12l-5 -5l1.5 -1.5a3.536 3.536 0 1 1 5 5l-1.5 1.5z"},child:[]},{tag:"path",attr:{d:"M3 21l2.5 -2.5"},child:[]},{tag:"path",attr:{d:"M18.5 5.5l2.5 -2.5"},child:[]},{tag:"path",attr:{d:"M10 11l-2 2"},child:[]},{tag:"path",attr:{d:"M13 14l-2 2"},child:[]}]})(e)}async function Y(e,...t){if(!!!window.pywebview)return console.error("Please use pywebview environment"),null;if(typeof e!="function")return console.error("Provided function is not valid."),null;try{return await e(...t)}catch(s){return console.error("Error executing the provided function:",s),null}}const Me=i.createContext(void 0),dt=({children:e})=>{const[t,n]=i.useState(!1),[s,o]=i.useState(""),[l,f]=i.useState([]),[b,w]=i.useState(0),[x,g]=i.useState([{title:"根目錄",key:"localStorage",children:void 0}]),[p,N]=i.useState([{title:"遠端根目錄",key:"remoteStorage",children:void 0}]);return r.jsx(Me.Provider,{value:{isLogining:t,setIsLogining:n,message:s,setMessage:o,sendStatus:l,setSendStatus:f,localTreeData:x,setLocalTreeData:g,remoteTreeData:p,setRemoteTreeData:N,fileTreeKey:b,setFileTreeKey:w},children:e})},K=()=>{const e=i.useContext(Me);if(e===void 0)throw new Error("useGlobalState must be used within a GlobalStateProvider");return e},ut=({toggleConnectStatusOpen:e,toggleLocalFileListOpen:t,toggleSendStatusOpen:n,toggleRemoteFileListOpen:s,handleReload:o})=>{const[l,f]=i.useState(!1),[b,w]=i.useState([]),[x,g]=i.useState("127.0.0.1"),[p,N]=i.useState(""),[_,j]=i.useState(""),[M,h]=i.useState("50051"),[S,k]=i.useState(""),[C,R]=i.useState(!1),[D,P]=i.useState(!1),{setIsLogining:y,setMessage:T}=K();i.useEffect(()=>{(async()=>{const L=await window.pywebview.api.read_host();w(L||[])})()},[]);const A=async()=>{if(x.trim()&&S.trim()&&_.trim()&&M.trim()){const d=b.some(L=>L.host===x);w(L=>{let F;return d?F=L.map(q=>q.host===x?{name:p,host:x,user:S,password:_,port:M}:q):F=[...L,{name:p.trim(),host:x.trim(),user:S,password:_,port:M}],window.pywebview.api.save_host(F),console.log("Data saved:",F),F}),g(""),k(""),j(""),h(""),N("")}},Z=()=>{console.log("Cancelling..."),T("Cancelling...")},$=()=>{console.log("Connecting to the last connected server..."),T("Connecting to the last connected server...")},U=async()=>{const d=await window.pywebview.api.close(),L=JSON.parse(d);T(L.message),y(!1)},m=d=>{switch(d.currentTarget.getAttribute("id")){case"1":e();break;case"2":t();break;case"3":s();break;case"4":n();break;case"5":Y(o);break;case"6":Y(Z);break;case"7":Y($);break;case"8":Y(U);break}},E=d=>{g(d.host),N(d.name),k(d.user),j(d.password),h(d.port),P(!0),f(!0)},O=d=>{console.log(`Connecting to ${d.host}`)},H=async d=>{const L=b.filter(F=>F.host!==d.host);w(L),await window.pywebview.api.save_host(L)},z=()=>{g("127.0.0.1"),k(""),j(""),h("50051"),N(""),P(!1),f(!1)};return r.jsxs("div",{className:"flex flex-row items-center space-x-5 bg-gray-500 border border-white",children:[r.jsxs("div",{className:"flex items-center",children:[r.jsx("button",{title:"站台管理員",onClick:()=>f(!0),children:r.jsx(rt,{className:"w-12 h-12 lg:w-20 lg:h-20 md:w-16 md:h-16",color:"#87A2FF"})}),r.jsx(je,{title:"保存資料管理",open:l,onCancel:z,cancelText:"關閉",okText:p?"保存":"新增",onOk:A,destroyOnClose:!0,children:r.jsxs("div",{className:"flex flex-row w-full",children:[r.jsx("div",{className:"w-1/2 text-center flex1 h-[250px] overflow-auto",children:r.jsx(se,{dataSource:b,header:r.jsx("div",{children:"站台列表"}),renderItem:(d,L)=>r.jsxs(se.Item,{onClick:()=>E(d),className:"w-full text-lg cursor-pointer",children:[r.jsx("p",{children:`${d.name}`}),r.jsxs("div",{children:[r.jsx(me,{className:"ml-2",onClick:F=>{F.stopPropagation(),H(d)},children:"刪除"}),r.jsx(me,{className:"ml-2",onClick:F=>{F.stopPropagation(),O(d)},children:"連線"})]})]},L)})}),r.jsx("div",{className:"w-1/2 text-center flex1",children:r.jsxs(Se,{direction:"vertical",children:[r.jsx(G,{placeholder:"名稱",value:p,disabled:D,onChange:d=>N(d.target.value)}),r.jsx(G,{placeholder:"主機地址",value:x,defaultValue:"127.0.0.1",onChange:d=>g(d.target.value)}),r.jsx(G,{placeholder:"使用者帳號",value:S,onChange:d=>k(d.target.value)}),r.jsx(G.Password,{placeholder:"使用者密碼",visibilityToggle:{visible:C,onVisibleChange:R},value:_,onChange:d=>j(d.target.value)}),r.jsx(G,{placeholder:"連接埠",value:M,defaultValue:"50051",onChange:d=>h(d.target.value)})]})})]})})]}),r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx("button",{title:"連線紀錄",id:"1",onClick:m,children:r.jsx(ot,{className:"w-12 h-12 lg:w-20 lg:h-20 md:w-16 md:h-16",color:"#ffc800"})}),r.jsx("button",{title:"切換本地目錄樹",id:"2",onClick:m,children:r.jsx(nt,{className:"w-12 h-12 lg:w-20 lg:h-20 md:w-16 md:h-16",color:"#7acf6a"})}),r.jsx("button",{title:"切換遠端目錄樹",id:"3",onClick:m,children:r.jsx(st,{className:"w-12 h-12 lg:w-20 lg:h-20 md:w-16 md:h-16",color:"#87A2FF"})}),r.jsx("button",{title:"檔案傳輸過程",id:"4",onClick:m,children:r.jsx(tt,{className:"w-12 h-12 lg:w-20 lg:h-20 md:w-16 md:h-16",color:"#5ba4a4"})})]}),r.jsxs("div",{className:"flex items-center",children:[r.jsx("button",{title:"重新整理檔案及資料夾",id:"5",onClick:m,children:r.jsx(lt,{className:"h-9 w-9 lg:w-16 lg:h-16 md:w-12 md:h-12",color:"#99ff99"})}),r.jsx("button",{title:"取消檔案動作",className:"ml-2 lg:ml-4 md:ml-3",id:"6",onClick:m,children:r.jsx(at,{className:"w-10 h-10 lg:w-20 lg:h-20 md:w-16 md:h-16",color:"#cc0000"})}),r.jsx("button",{title:"連接伺服器",className:"ml-1 md:ml-2",id:"7",onClick:m,children:r.jsx(ct,{className:"w-10 h-10 lg:w-20 lg:h-20 md:w-16 md:h-16",color:"#99ff33"})}),r.jsx("button",{title:"中斷伺服器",className:"-ml-1 md:-ml-2",id:"8",onClick:m,children:r.jsx(it,{className:"w-10 h-10 lg:w-20 lg:h-20 md:w-16 md:h-16",color:"#ff6600"})})]})]})},ft=()=>{const[e,t]=i.useState("127.0.0.1"),[n,s]=i.useState(""),[o,l]=i.useState(""),[f,b]=i.useState("50051"),{setIsLogining:w,setMessage:x}=K(),g=async()=>{await Y(async()=>{if(e===""||f===""||n===""||o===""){x("請輸入完整資訊");return}const p=await window.pywebview.api.login(e,f,n,o),N=JSON.parse(p);"error"in N?x(N.error):(x(N.message),w(!0))})};return r.jsxs("div",{className:"flex flex-wrap items-center justify-start p-2 bg-gray-500 border border-white gap-7",children:[r.jsxs("div",{className:"flex items-center",children:[r.jsx("label",{htmlFor:"host",className:"mr-1 text-sm text-white whitespace-nowrap",children:"主機(H):"}),r.jsx("input",{type:"text",id:"host",className:"px-2 py-1 text-sm border border-gray-300 rounded w-28 focus:outline-none focus:ring-1 focus:ring-cyan-500",value:e,onChange:p=>t(p.target.value)})]}),r.jsxs("div",{className:"flex items-center",children:[r.jsx("label",{htmlFor:"username",className:"mr-1 text-sm text-white whitespace-nowrap",children:"使用者名稱(U):"}),r.jsx("input",{type:"text",id:"username",className:"px-2 py-1 text-sm border border-gray-300 rounded w-28 focus:outline-none focus:ring-1 focus:ring-cyan-500",value:n,onChange:p=>s(p.target.value)})]}),r.jsxs("div",{className:"flex items-center",children:[r.jsx("label",{htmlFor:"password",className:"mr-1 text-sm text-white whitespace-nowrap",children:"密碼(W):"}),r.jsx("input",{type:"password",id:"password",className:"px-2 py-1 text-sm border border-gray-300 rounded w-28 focus:outline-none focus:ring-1 focus:ring-cyan-500",value:o,onChange:p=>l(p.target.value)})]}),r.jsxs("div",{className:"flex items-center",children:[r.jsx("label",{htmlFor:"port",className:"mr-1 text-sm text-white whitespace-nowrap",children:"連接埠(P):"}),r.jsx("input",{type:"number",id:"port",className:"w-20 px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-cyan-500",value:f,onChange:p=>b(p.target.value)})]}),r.jsx("button",{className:"px-3 py-1 text-sm text-white bg-blue-600 rounded hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500",onClick:g,children:"快速連線(Q)"})]})},ht=()=>{const[e,t]=i.useState([]),n=i.useRef(null),{message:s}=K();return i.useEffect(()=>{t(o=>[...o,s])},[s]),i.useEffect(()=>{n.current&&(n.current.scrollTop=n.current.scrollHeight)},[e]),r.jsx("div",{ref:n,className:"w-full h-full p-2 overflow-auto bg-gray-500 border",style:{maxHeight:"400px"},children:r.jsx(Se,{direction:"vertical",children:r.jsx(se,{dataSource:e,renderItem:(o,l)=>r.jsx(se.Item,{style:{paddingTop:"2px",paddingBottom:"2px"},children:r.jsx("div",{className:"flex items-center w-full h-full px-2 text-white",children:o})},l)})})})};function Le(e){var t,n,s="";if(typeof e=="string"||typeof e=="number")s+=e;else if(typeof e=="object")if(Array.isArray(e))for(t=0;t<e.length;t++)e[t]&&(n=Le(e[t]))&&(s&&(s+=" "),s+=n);else for(t in e)e[t]&&(s&&(s+=" "),s+=t);return s}function ne(){for(var e,t,n=0,s="";n<arguments.length;)(e=arguments[n++])&&(t=Le(e))&&(s&&(s+=" "),s+=t);return s}var Pe=i.createContext({}),pt=()=>i.useContext(Pe),mt=e=>V.createElement(Pe.Provider,{...e});function gt(){let e=new Map;return{on(t,n){return e.has(t)?e.get(t).add(n):e.set(t,new Set([n])),this},off(t,n){return e.has(t)&&e.get(t).delete(n),this},emit(t,n){return e.has(t)&&e.get(t).forEach(s=>{s(n)}),this}}}var ae=gt(),vt=()=>i.useRef(new Map).current,wt=()=>{},xe=["resize","contextmenu","click","scroll","blur"],fe={show({event:e,id:t,props:n,position:s}){e.preventDefault&&e.preventDefault(),ae.emit(0).emit(t,{event:e.nativeEvent||e,props:n,position:s})},hideAll(){ae.emit(0)}};function xt(){let e=new Map,t,n,s,o,l=!1;function f(h){o=Array.from(h.values()),t=-1,s=!0}function b(){o[t].node.focus()}let w=()=>t>=0&&o[t].isSubmenu,x=()=>Array.from(o[t].submenuRefTracker.values());function g(){return t===-1?(p(),!1):!0}function p(){t+1<o.length?t++:t+1===o.length&&(t=0),l&&j(),b()}function N(){t===-1||t===0?t=o.length-1:t-1<o.length&&t--,l&&j(),b()}function _(){if(g()&&w()){let h=x(),{node:S,setSubmenuPosition:k}=o[t];return e.set(S,{isRoot:s,focusedIndex:t,parentNode:n||S,items:o}),k(),S.classList.add("contexify_submenu-isOpen"),n=S,h.length>0?(t=0,o=h):l=!0,s=!1,b(),!0}return!1}function j(){if(g()&&!s){let h=e.get(n);n.classList.remove("contexify_submenu-isOpen"),o=h.items,n=h.parentNode,h.isRoot&&(s=!0,e.clear()),l||(t=h.focusedIndex,b())}}function M(h){function S(k){for(let C of k)C.isSubmenu&&C.submenuRefTracker&&S(Array.from(C.submenuRefTracker.values())),C.keyMatcher&&C.keyMatcher(h)}S(o)}return{init:f,moveDown:p,moveUp:N,openSubmenu:_,closeSubmenu:j,matchKeys:M}}function X(e){return typeof e=="function"}function ye(e){return typeof e=="string"}function yt(e,t){return i.Children.map(i.Children.toArray(e).filter(Boolean),n=>i.cloneElement(n,t))}function bt(e){let t={x:e.clientX,y:e.clientY},n=e.changedTouches;return n&&(t.x=n[0].clientX,t.y=n[0].clientY),(!t.x||t.x<0)&&(t.x=0),(!t.y||t.y<0)&&(t.y=0),t}function be(e,t){return X(e)?e(t):e}function jt(e,t){return{...e,...X(t)?t(e):t}}var Fe=({id:e,theme:t,style:n,className:s,children:o,animation:l="fade",preventDefaultOnKeydown:f=!0,disableBoundariesCheck:b=!1,onVisibilityChange:w,...x})=>{let[g,p]=i.useReducer(jt,{x:0,y:0,visible:!1,triggerEvent:{},propsFromTrigger:null,willLeave:!1}),N=i.useRef(null),_=vt(),[j]=i.useState(()=>xt()),M=i.useRef(),h=i.useRef();i.useEffect(()=>(ae.on(e,k).on(0,C),()=>{ae.off(e,k).off(0,C)}),[e,l,b]),i.useEffect(()=>{g.visible?j.init(_):_.clear()},[g.visible,j,_]);function S(m,E){if(N.current&&!b){let{innerWidth:O,innerHeight:H}=window,{offsetWidth:z,offsetHeight:d}=N.current;m+z>O&&(m-=m+z-O),E+d>H&&(E-=E+d-H)}return{x:m,y:E}}i.useEffect(()=>{g.visible&&p(S(g.x,g.y))},[g.visible]),i.useEffect(()=>{function m(O){f&&O.preventDefault()}function E(O){switch(O.key){case"Enter":case" ":j.openSubmenu()||C();break;case"Escape":C();break;case"ArrowUp":m(O),j.moveUp();break;case"ArrowDown":m(O),j.moveDown();break;case"ArrowRight":m(O),j.openSubmenu();break;case"ArrowLeft":m(O),j.closeSubmenu();break;default:j.matchKeys(O);break}}if(g.visible){window.addEventListener("keydown",E);for(let O of xe)window.addEventListener(O,C)}return()=>{window.removeEventListener("keydown",E);for(let O of xe)window.removeEventListener(O,C)}},[g.visible,j,f]);function k({event:m,props:E,position:O}){m.stopPropagation();let H=O||bt(m),{x:z,y:d}=S(H.x,H.y);ue.flushSync(()=>{p({visible:!0,willLeave:!1,x:z,y:d,triggerEvent:m,propsFromTrigger:E})}),clearTimeout(h.current),!M.current&&X(w)&&(w(!0),M.current=!0)}function C(m){m!=null&&(m.button===2||m.ctrlKey)&&m.type!=="contextmenu"||(l&&(ye(l)||"exit"in l&&l.exit)?p(E=>({willLeave:E.visible})):p(E=>({visible:E.visible?!1:E.visible})),h.current=setTimeout(()=>{X(w)&&w(!1),M.current=!1}))}function R(){g.willLeave&&g.visible&&ue.flushSync(()=>p({visible:!1,willLeave:!1}))}function D(){return ye(l)?ne({[`contexify_willEnter-${l}`]:P&&!$,[`contexify_willLeave-${l} contexify_willLeave-'disabled'`]:P&&$}):l&&"enter"in l&&"exit"in l?ne({[`contexify_willEnter-${l.enter}`]:l.enter&&P&&!$,[`contexify_willLeave-${l.exit} contexify_willLeave-'disabled'`]:l.exit&&P&&$}):null}let{visible:P,triggerEvent:y,propsFromTrigger:T,x:A,y:Z,willLeave:$}=g,U=ne("contexify",s,{[`contexify_theme-${t}`]:t},D());return V.createElement(mt,{value:_},P&&V.createElement("div",{...x,className:U,onAnimationEnd:R,style:{...n,left:A,top:Z,opacity:1},ref:N,role:"menu"},yt(o,{propsFromTrigger:T,triggerEvent:y})))},J=({id:e,children:t,className:n,style:s,triggerEvent:o,data:l,propsFromTrigger:f,keyMatcher:b,onClick:w=wt,disabled:x=!1,hidden:g=!1,closeOnClick:p=!0,handlerEvent:N="onClick",..._})=>{let j=i.useRef(),M=pt(),h={id:e,data:l,triggerEvent:o,props:f},S=be(x,h),k=be(g,h);function C(y){h.event=y,y.stopPropagation(),S||(p?R():w(h))}function R(){let y=j.current;y.focus(),y.addEventListener("animationend",()=>setTimeout(fe.hideAll),{once:!0}),y.classList.add("contexify_item-feedback"),w(h)}function D(y){y&&!S&&(j.current=y,M.set(y,{node:y,isSubmenu:!1,keyMatcher:!S&&X(b)&&(T=>{b(T)&&(T.stopPropagation(),T.preventDefault(),h.event=T,R())})}))}function P(y){(y.key==="Enter"||y.key===" ")&&(y.stopPropagation(),h.event=y,R())}return k?null:V.createElement("div",{..._,[N]:C,className:ne("contexify_item",n,{"contexify_item-disabled":S}),style:s,onKeyDown:P,ref:D,tabIndex:-1,role:"menuitem","aria-disabled":S},V.createElement("div",{className:"contexify_itemContent"},t))};const{DirectoryTree:St}=Ae,{Option:Nt}=Ne,Ct=e=>({fileMenuId:`file_menu_${e?"local":"remote"}`,folderMenuId:`folder_menu_${e?"local":"remote"}`}),Ot=({nodeKey:e,onOpenFolder:t,nodeTitle:n,isLocal:s,menuId:o,disableMenu:l})=>r.jsxs(Fe,{id:o,children:[r.jsx(J,{onClick:()=>t(e),disabled:l,children:"開啟資料夾"}),r.jsx(J,{onClick:()=>console.log(s?"新增檔案":"新增遠端檔案"),disabled:l,children:s?"新增檔案":"新增遠端檔案"}),r.jsx(J,{onClick:()=>console.log("刪除資料夾"),disabled:l||n==="根目錄"||n==="遠端根目錄"||n==="downloads"||n==="uploads",children:"刪除資料夾"})]}),Te=({initialTreeData:e=[{title:"根目錄",key:"root",children:void 0}],isLocal:t,onNodeSelect:n})=>{const[s,o]=i.useState(e),[l,f]=i.useState([]),[b,w]=i.useState(""),[x,g]=i.useState(null),[p,N]=i.useState([]),[_,j]=i.useState([]),[M,h]=i.useState(!1),[S,k]=i.useState(!1),[C,R]=i.useState(""),{setSendStatus:D,setFileTreeKey:P,setMessage:y,isLogining:T}=K(),A=Ct(t);i.useEffect(()=>{f(t?["localStorage"]:["remoteStorage"])},[t]);const Z=async(a,c,u,v)=>{const Q=c.key,De=await window.pywebview.api.get_file_size(Q),ee=JSON.parse(De);if(ee.error){y(ee.error),console.error(ee.error);return}const He=`${ee.size}`,de=a==="上傳檔案"?"上傳":"下載";console.log(c.key);const he=c.key.match(/[/\\]remoteStorage[/\\].+/);let pe;he&&(pe=he[0]);const Ie=t?"":`${pe}`;D(W=>[...W,{fileName:String(c.title),fileSize:He,direction:de,remotePath:Ie,status:"傳送中"}]);try{a==="上傳檔案"?await window.pywebview.api.upload_file_to_remote(Q,u||""):a==="下載檔案"&&await window.pywebview.api.download_file_to_local(Q,v||"");const W=await window.pywebview.api.get_file_size(Q),te=JSON.parse(W);if(te.error)throw new Error(te.error);D(B=>B.map(re=>re.fileName===String(c.title)&&re.direction===de?{...re,status:"完成"}:re)),P(B=>B+1)}catch(W){console.error("File action failed:",W),D(te=>te.map(B=>B.fileName===String(c.title)&&B.direction===de?{...B,status:"失敗"}:B))}},$=async()=>{if(x){const a=ce(s,x);if(a)try{const c=await window.pywebview.api.delete_file(a.key,t),u=JSON.parse(c);if(u.error){console.error("Error:",u.error),y(u.error);return}P(v=>v+1)}catch(c){console.error("Failed to delete file:",c),y("刪除檔案失敗")}}},U=({isLocal:a,menuId:c,disableMenu:u})=>r.jsxs(Fe,{id:c,children:[r.jsx(J,{onClick:()=>console.log("開啟檔案"),disabled:u,children:"開啟檔案"}),r.jsx(J,{onClick:$,disabled:u,children:"刪除檔案"}),r.jsx(J,{onClick:()=>{console.log(a?"上傳":"下載"),a?O():z()},disabled:u,children:a?"上傳檔案":"下載檔案"})]}),m=(a,c,u)=>a.map(v=>v.key===c?{...v,children:u}:v.children?{...v,children:m(v.children,c,u)}:v),E=async()=>{try{const a=await window.pywebview.api.get_remote_folders(),c=a?JSON.parse(a):[];return c.error?(console.error("Error:",c.error),y(c.error),[]):c.folders||[]}catch(a){return console.error("Failed to fetch remote folders:",a),[]}},O=async()=>{if(!T){y("請先登入");return}const a=await E();N(a),h(!0)},H=async()=>{try{const a=await window.pywebview.api.get_local_folders(),c=a?JSON.parse(a):[];return c.error?(console.error("Error:",c.error),[]):(console.log("data",c.folders),c.folders||[])}catch(a){return console.error("Failed to fetch local folders:",a),[]}},z=async()=>{const a=await H();j(a),k(!0)},d=async a=>{try{const c=await window.pywebview.api.get_local_children(a),u=JSON.parse(c);return u.error?(console.error("Error:",u.error),[]):!Array.isArray(u)||u.length===0?[{title:"無檔案",key:`${a}-empty`,isLeaf:!0}]:u.map(v=>({title:v.title,key:v.key,isLeaf:v.isLeaf,children:v.children||void 0}))}catch(c){return console.error("Failed to fetch local children:",c),[]}},L=async a=>{try{const c=await window.pywebview.api.get_server_children(a),u=JSON.parse(c);return u.error?(console.error("Error:",u.error),[]):!Array.isArray(u)||u.length===0?[{title:"無檔案",key:`${a}-empty`,isLeaf:!0}]:u.map(v=>({title:v.title,key:v.key,isLeaf:v.isLeaf,children:v.children||void 0}))}catch(c){return console.error("Failed to fetch remote children:",c),[]}},F=async({key:a,children:c})=>{if(c)return Promise.resolve();const u=t?await d(a):await L(a);o(v=>m(v,a,u))},q=(a,c)=>{if(a.preventDefault(),String(c.key).includes("-empty")||c.children&&c.children.length===0)return;const u=typeof c.title=="string"?c.title:String(c.title);w(u),g(c.key);const v=c.children&&c.children.length===0;c.isLeaf?fe.show({id:A.fileMenuId,event:a,props:{node:c,disableMenu:v}}):fe.show({id:A.folderMenuId,event:a,props:{node:c,disableMenu:v}})},Ve=a=>{f(c=>[...c,a])},ce=(a,c)=>{for(const u of a){if(u.key===c)return u;if(u.children){const v=ce(u.children,c);if(v)return v}}return null},Re=async()=>{if(C&&x){const a=ce(s,x);a&&(t?await Z("上傳檔案",a,C,void 0):await Z("下載檔案",a,"",C))}t?k(!1):h(!1)};return r.jsxs(r.Fragment,{children:[r.jsx(St,{loadData:F,treeData:s,onSelect:(a,{node:c})=>n&&n(a[0],c),expandedKeys:l,onRightClick:({event:a,node:c})=>q(a,c),onExpand:a=>f(a)}),r.jsx(je,{title:"選擇目標資料夾",open:t?M:S,onOk:()=>{C&&Re(),h(!1),k(!1)},onCancel:()=>{h(!1),k(!1)},destroyOnClose:!0,children:r.jsx(Ne,{style:{width:"100%"},placeholder:"選擇資料夾",onChange:a=>R(a),value:C,children:(t?p:_).map(a=>r.jsx(Nt,{value:a,children:a},a))})}),r.jsx(U,{isLocal:t,menuId:A.fileMenuId,disableMenu:!1}),x!==null&&r.jsx(Ot,{nodeKey:x,onOpenFolder:Ve,nodeTitle:b,isLocal:t,menuId:A.folderMenuId,disableMenu:!1})]})},kt=(e,t)=>{console.log("Selected node key:",e)},Et=()=>{const{localTreeData:e}=K();return r.jsx("div",{className:"h-full px-2 py-1 bg-gray-500 border-2 rounded",children:r.jsx(Te,{onNodeSelect:kt,initialTreeData:e,isLocal:!0})})},_t=(e,t)=>{console.log("Selected remote node key:",e)},Mt=()=>{const{isLogining:e,remoteTreeData:t}=K();return r.jsx("div",{className:"h-full px-2 py-1 bg-gray-500 border-2 rounded",children:e?r.jsx(Te,{onNodeSelect:_t,initialTreeData:t,isLocal:!1}):r.jsx($e,{description:"請先登入"})})},Lt=({localOpen:e,remoteOpen:t})=>r.jsxs("div",{className:"flex flex-row w-full h-full gap-2",children:[e&&r.jsx("div",{className:"flex-1",children:r.jsx(Et,{})}),t&&r.jsx("div",{className:"flex-1",children:r.jsx(Mt,{})})]}),Pt=()=>{const{sendStatus:e}=K(),t=i.useRef(null);return console.log(e),i.useEffect(()=>{t.current&&t.current.scrollIntoView({behavior:"smooth"})},[e]),r.jsxs("div",{className:"box-border w-full h-full p-2 pb-4 bg-gray-500 border rounded",children:[r.jsxs("div",{className:"box-border grid grid-cols-5 gap-1 p-2 text-white bg-gray-600 border rounded",children:[r.jsx("div",{className:"col-span-1 truncate",children:"檔案名稱"}),r.jsx("div",{className:"col-span-1 truncate",children:"檔案大小/本地檔案"}),r.jsx("div",{className:"col-span-1 truncate",children:"方向"}),r.jsx("div",{className:"col-span-1 truncate",children:"遠端檔案"}),r.jsx("div",{className:"col-span-1 truncate",children:"狀態"})]}),r.jsx("div",{className:"overflow-y-auto",style:{maxHeight:"3.5rem"},children:e.map((n,s)=>r.jsxs("div",{ref:s===e.length-1?t:null,className:`grid grid-cols-5 gap-1 p-2 ${s%2===0?"bg-gray-400":"bg-gray-300"} border rounded box-border`,children:[r.jsx("div",{className:"col-span-1 truncate",children:n.fileName}),r.jsxs("div",{className:"col-span-1 truncate",children:[n.fileSize," "]}),r.jsx("div",{className:"col-span-1 truncate",children:n.direction}),r.jsx("div",{className:"col-span-1 truncate",children:n.remotePath}),r.jsx("div",{className:"col-span-1 truncate",children:n.status})]},s))})]})},Ft=()=>{const[e,t]=i.useState(!0),[n,s]=i.useState(!0),[o,l]=i.useState(!0),[f,b]=i.useState(!0),{fileTreeKey:w,setFileTreeKey:x}=K(),g=()=>{console.log("Reloading..."),x(M=>M+1)},p=()=>t(!e),N=()=>s(!n),_=()=>b(!f),j=()=>l(!o);return console.log(n,o),r.jsxs("div",{className:"grid grid-rows-[auto_auto_2fr_auto] h-screen min-w-full gap-1 p-2 bg-gray-700",children:[r.jsxs("div",{children:[r.jsx(ut,{handleReload:g,toggleConnectStatusOpen:p,toggleLocalFileListOpen:N,toggleRemoteFileListOpen:j,toggleSendStatusOpen:_}),r.jsx(ft,{})]}),e&&r.jsx("div",{className:"h-28",children:r.jsx(ht,{})}),(n||o)&&r.jsx("div",{className:"grid grid-cols-1 gap-1",children:r.jsx(Lt,{localOpen:n,remoteOpen:o},w)}),f&&r.jsx("div",{className:"h-28",children:r.jsx(Pt,{})})]})};ke(document.getElementById("root")).render(r.jsx(i.StrictMode,{children:r.jsx(dt,{children:r.jsx(Ft,{})})}));
