import{r as a,a as fe,H as V,M as Ne,L as le,B as ge,S as Ce,I as q,b as Oe,T as Ke,E as Ze}from"./antd-CgqAf7up.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))o(i);new MutationObserver(i=>{for(const c of i)if(c.type==="childList")for(const f of c.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&o(f)}).observe(document,{childList:!0,subtree:!0});function n(i){const c={};return i.integrity&&(c.integrity=i.integrity),i.referrerPolicy&&(c.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?c.credentials="include":i.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function o(i){if(i.ep)return;i.ep=!0;const c=n(i);fetch(i.href,c)}})();var ke={exports:{}},de={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Je=a,Ue=Symbol.for("react.element"),We=Symbol.for("react.fragment"),Ge=Object.prototype.hasOwnProperty,Ye=Je.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Xe={key:!0,ref:!0,__self:!0,__source:!0};function Ee(e,t,n){var o,i={},c=null,f=null;n!==void 0&&(c=""+n),t.key!==void 0&&(c=""+t.key),t.ref!==void 0&&(f=t.ref);for(o in t)Ge.call(t,o)&&!Xe.hasOwnProperty(o)&&(i[o]=t[o]);if(e&&e.defaultProps)for(o in t=e.defaultProps,t)i[o]===void 0&&(i[o]=t[o]);return{$$typeof:Ue,type:e,key:c,ref:f,props:i,_owner:Ye.current}}de.Fragment=We;de.jsx=Ee;de.jsxs=Ee;ke.exports=de;var r=ke.exports,_e,we=fe;_e=we.createRoot,we.hydrateRoot;var Me={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},ve=V.createContext&&V.createContext(Me),qe=["attr","size","title"];function Qe(e,t){if(e==null)return{};var n=et(e,t),o,i;if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(i=0;i<c.length;i++)o=c[i],!(t.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(e,o)&&(n[o]=e[o])}return n}function et(e,t){if(e==null)return{};var n={};for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){if(t.indexOf(o)>=0)continue;n[o]=e[o]}return n}function ie(){return ie=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},ie.apply(this,arguments)}function xe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,o)}return n}function ae(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?xe(Object(n),!0).forEach(function(o){tt(e,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):xe(Object(n)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))})}return e}function tt(e,t,n){return t=rt(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function rt(e){var t=nt(e,"string");return typeof t=="symbol"?t:t+""}function nt(e,t){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var o=n.call(e,t||"default");if(typeof o!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Le(e){return e&&e.map((t,n)=>V.createElement(t.tag,ae({key:n},t.attr),Le(t.child)))}function A(e){return t=>V.createElement(ot,ie({attr:ae({},e.attr)},t),Le(e.child))}function ot(e){var t=n=>{var{attr:o,size:i,title:c}=e,f=Qe(e,qe),b=i||n.size||"1em",y;return n.className&&(y=n.className),e.className&&(y=(y?y+" ":"")+e.className),V.createElement("svg",ie({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},n.attr,o,f,{className:y,style:ae(ae({color:e.color||n.color},n.style),e.style),height:b,width:b,xmlns:"http://www.w3.org/2000/svg"}),c&&V.createElement("title",null,c),e.children)};return ve!==void 0?V.createElement(ve.Consumer,null,n=>t(n)):t(Me)}function st(e){return A({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M16 16V12L21 17L16 22V18H4V16H16ZM8 2V5.999L20 6V8H8V12L3 7L8 2Z"},child:[]}]})(e)}function lt(e){return A({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M4 3H20C20.5523 3 21 3.44772 21 4V11H3V4C3 3.44772 3.44772 3 4 3ZM3 13H21V20C21 20.5523 20.5523 21 20 21H4C3.44772 21 3 20.5523 3 20V13ZM7 16V18H10V16H7ZM7 6V8H10V6H7Z"},child:[]}]})(e)}function it(e){return A({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M3 4H21V6H3V4ZM3 19H21V21H3V19ZM11 14H21V16H11V14ZM11 9H21V11H11V9ZM3 12.5L7 9V16L3 12.5Z"},child:[]}]})(e)}function at(e){return A({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M3 4H21V6H3V4ZM3 19H21V21H3V19ZM11 14H21V16H11V14ZM11 9H21V11H11V9ZM7 12.5L3 16V9L7 12.5Z"},child:[]}]})(e)}function ct(e){return A({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M12 22C6.47715 22 2 17.5228 2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22ZM12 9.5C12.8284 9.5 13.5 8.82843 13.5 8C13.5 7.17157 12.8284 6.5 12 6.5C11.1716 6.5 10.5 7.17157 10.5 8C10.5 8.82843 11.1716 9.5 12 9.5ZM14 15H13V10.5H10V12.5H11V15H10V17H14V15Z"},child:[]}]})(e)}function dt(e){return A({tag:"svg",attr:{version:"1.1",viewBox:"0 0 17 17"},child:[{tag:"g",attr:{},child:[]},{tag:"path",attr:{d:"M6 8h-6v-6h1v4.109c1.013-3.193 4.036-5.484 7.5-5.484 3.506 0 6.621 2.36 7.574 5.739l-0.963 0.271c-0.832-2.95-3.551-5.011-6.611-5.011-3.226 0.001-6.016 2.276-6.708 5.376h4.208v1zM11 9v1h4.208c-0.693 3.101-3.479 5.375-6.708 5.375-3.062 0-5.78-2.061-6.611-5.011l-0.963 0.271c0.952 3.379 4.067 5.739 7.574 5.739 3.459 0 6.475-2.28 7.5-5.482v4.108h1v-6h-6z"},child:[]}]})(e)}function ut(e){return A({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 16C123.45 16 16 123.45 16 256s107.45 240 240 240 240-107.45 240-240S388.55 16 256 16zm0 60c99.41 0 180 80.59 180 180s-80.59 180-180 180S76 355.41 76 256 156.59 76 256 76zm-80.625 60c-.97-.005-2.006.112-3.063.313v-.032c-18.297 3.436-45.264 34.743-33.375 46.626l73.157 73.125-73.156 73.126c-14.63 14.625 29.275 58.534 43.906 43.906L256 299.906l73.156 73.156c14.63 14.628 58.537-29.28 43.906-43.906l-73.156-73.125 73.156-73.124c14.63-14.625-29.275-58.5-43.906-43.875L256 212.157l-73.156-73.125c-2.06-2.046-4.56-3.015-7.47-3.03z"},child:[]}]})(e)}function ft(e){return A({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M20 16l-4 4"},child:[]},{tag:"path",attr:{d:"M7 12l5 5l-1.5 1.5a3.536 3.536 0 1 1 -5 -5l1.5 -1.5z"},child:[]},{tag:"path",attr:{d:"M17 12l-5 -5l1.5 -1.5a3.536 3.536 0 1 1 5 5l-1.5 1.5z"},child:[]},{tag:"path",attr:{d:"M3 21l2.5 -2.5"},child:[]},{tag:"path",attr:{d:"M18.5 5.5l2.5 -2.5"},child:[]},{tag:"path",attr:{d:"M10 11l-2 2"},child:[]},{tag:"path",attr:{d:"M13 14l-2 2"},child:[]},{tag:"path",attr:{d:"M16 16l4 4"},child:[]}]})(e)}function ht(e){return A({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M7 12l5 5l-1.5 1.5a3.536 3.536 0 1 1 -5 -5l1.5 -1.5z"},child:[]},{tag:"path",attr:{d:"M17 12l-5 -5l1.5 -1.5a3.536 3.536 0 1 1 5 5l-1.5 1.5z"},child:[]},{tag:"path",attr:{d:"M3 21l2.5 -2.5"},child:[]},{tag:"path",attr:{d:"M18.5 5.5l2.5 -2.5"},child:[]},{tag:"path",attr:{d:"M10 11l-2 2"},child:[]},{tag:"path",attr:{d:"M13 14l-2 2"},child:[]}]})(e)}async function Q(e,...t){if(!!!window.pywebview)return console.error("Please use pywebview environment"),null;if(typeof e!="function")return console.error("Provided function is not valid."),null;try{return await e(...t)}catch(o){return console.error("Error executing the provided function:",o),null}}const Fe=a.createContext(void 0),pt=({children:e})=>{const[t,n]=a.useState(!1),[o,i]=a.useState(""),[c,f]=a.useState([]),[b,y]=a.useState(0),[m,x]=a.useState([{title:"根目錄",key:"localStorage",children:void 0}]),[g,N]=a.useState([{title:"遠端根目錄",key:"remoteStorage",children:void 0}]);return r.jsx(Fe.Provider,{value:{isLogining:t,setIsLogining:n,message:o,setMessage:i,sendStatus:c,setSendStatus:f,localTreeData:m,setLocalTreeData:x,remoteTreeData:g,setRemoteTreeData:N,fileTreeKey:b,setFileTreeKey:y},children:e})},K=()=>{const e=a.useContext(Fe);if(e===void 0)throw new Error("useGlobalState must be used within a GlobalStateProvider");return e},mt=({toggleConnectStatusOpen:e,toggleLocalFileListOpen:t,toggleSendStatusOpen:n,toggleRemoteFileListOpen:o,handleReload:i})=>{const[c,f]=a.useState(!1),[b,y]=a.useState([]),[m,x]=a.useState("127.0.0.1"),[g,N]=a.useState(""),[_,j]=a.useState(""),[M,h]=a.useState("50051"),[S,E]=a.useState(""),[C,R]=a.useState(!1),[D,F]=a.useState(!1),{setIsLogining:w,setMessage:T}=K();a.useEffect(()=>{(async()=>{const L=await window.pywebview.api.read_host();y(L||[])})()},[]);const U=async()=>{if(m.trim()&&S.trim()&&_.trim()&&M.trim()){const u=b.some(L=>L.host===m);y(L=>{let P;return u?P=L.map(te=>te.host===m?{name:g,host:m,user:S,password:_,port:M}:te):P=[...L,{name:g.trim(),host:m.trim(),user:S,password:_,port:M}],window.pywebview.api.save_host(P),console.log("Data saved:",P),P}),x(""),E(""),j(""),h(""),N("")}},W=()=>{console.log("Cancelling..."),T("Cancelling...")},$=()=>{console.log("Connecting to the last connected server..."),T("Connecting to the last connected server...")},z=async()=>{const u=await window.pywebview.api.close(),L=JSON.parse(u);T(L.message),w(!1)},v=u=>{switch(u.currentTarget.getAttribute("id")){case"1":e();break;case"2":t();break;case"3":o();break;case"4":n();break;case"5":Q(i);break;case"6":Q(W);break;case"7":Q($);break;case"8":Q(z);break}},k=u=>{x(u.host),N(u.name),E(u.user),j(u.password),h(u.port),F(!0),f(!0)},O=u=>{console.log(`Connecting to ${u.host}`)},H=async u=>{const L=b.filter(P=>P.host!==u.host);y(L),await window.pywebview.api.save_host(L)},I=()=>{x("127.0.0.1"),E(""),j(""),h("50051"),N(""),F(!1),f(!1)};return r.jsxs("div",{className:"flex flex-row items-center space-x-5 bg-gray-500 border border-white",children:[r.jsxs("div",{className:"flex items-center",children:[r.jsx("button",{title:"站台管理員",onClick:()=>f(!0),children:r.jsx(lt,{className:"w-12 h-12 lg:w-20 lg:h-20 md:w-16 md:h-16",color:"#87A2FF"})}),r.jsx(Ne,{title:"保存資料管理",open:c,onCancel:I,cancelText:"關閉",okText:g?"保存":"新增",onOk:U,destroyOnClose:!0,children:r.jsxs("div",{className:"flex flex-row w-full",children:[r.jsx("div",{className:"w-1/2 text-center flex1 h-[250px] overflow-auto",children:r.jsx(le,{dataSource:b,header:r.jsx("div",{children:"站台列表"}),renderItem:(u,L)=>r.jsxs(le.Item,{onClick:()=>k(u),className:"w-full text-lg cursor-pointer",children:[r.jsx("p",{children:`${u.name}`}),r.jsxs("div",{children:[r.jsx(ge,{className:"ml-2",onClick:P=>{P.stopPropagation(),H(u)},children:"刪除"}),r.jsx(ge,{className:"ml-2",onClick:P=>{P.stopPropagation(),O(u)},children:"連線"})]})]},L)})}),r.jsx("div",{className:"w-1/2 text-center flex1",children:r.jsxs(Ce,{direction:"vertical",children:[r.jsx(q,{placeholder:"名稱",value:g,disabled:D,onChange:u=>N(u.target.value)}),r.jsx(q,{placeholder:"主機地址",value:m,defaultValue:"127.0.0.1",onChange:u=>x(u.target.value)}),r.jsx(q,{placeholder:"使用者帳號",value:S,onChange:u=>E(u.target.value)}),r.jsx(q.Password,{placeholder:"使用者密碼",visibilityToggle:{visible:C,onVisibleChange:R},value:_,onChange:u=>j(u.target.value)}),r.jsx(q,{placeholder:"連接埠",value:M,defaultValue:"50051",onChange:u=>h(u.target.value)})]})})]})})]}),r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx("button",{title:"連線紀錄",id:"1",onClick:v,children:r.jsx(ct,{className:"w-12 h-12 lg:w-20 lg:h-20 md:w-16 md:h-16",color:"#ffc800"})}),r.jsx("button",{title:"切換本地目錄樹",id:"2",onClick:v,children:r.jsx(it,{className:"w-12 h-12 lg:w-20 lg:h-20 md:w-16 md:h-16",color:"#7acf6a"})}),r.jsx("button",{title:"切換遠端目錄樹",id:"3",onClick:v,children:r.jsx(at,{className:"w-12 h-12 lg:w-20 lg:h-20 md:w-16 md:h-16",color:"#87A2FF"})}),r.jsx("button",{title:"檔案傳輸過程",id:"4",onClick:v,children:r.jsx(st,{className:"w-12 h-12 lg:w-20 lg:h-20 md:w-16 md:h-16",color:"#5ba4a4"})})]}),r.jsxs("div",{className:"flex items-center",children:[r.jsx("button",{title:"重新整理檔案及資料夾",id:"5",onClick:v,children:r.jsx(dt,{className:"h-9 w-9 lg:w-16 lg:h-16 md:w-12 md:h-12",color:"#99ff99"})}),r.jsx("button",{title:"取消檔案動作",className:"ml-2 lg:ml-4 md:ml-3",id:"6",onClick:v,children:r.jsx(ut,{className:"w-10 h-10 lg:w-20 lg:h-20 md:w-16 md:h-16",color:"#cc0000"})}),r.jsx("button",{title:"連接伺服器",className:"ml-1 md:ml-2",id:"7",onClick:v,children:r.jsx(ht,{className:"w-10 h-10 lg:w-20 lg:h-20 md:w-16 md:h-16",color:"#99ff33"})}),r.jsx("button",{title:"中斷伺服器",className:"-ml-1 md:-ml-2",id:"8",onClick:v,children:r.jsx(ft,{className:"w-10 h-10 lg:w-20 lg:h-20 md:w-16 md:h-16",color:"#ff6600"})})]})]})},gt=()=>{const[e,t]=a.useState("127.0.0.1"),[n,o]=a.useState(""),[i,c]=a.useState(""),[f,b]=a.useState("50051"),{setIsLogining:y,setMessage:m}=K(),x=async()=>{await Q(async()=>{if(e===""||f===""||n===""||i===""){m("請輸入完整資訊");return}const g=await window.pywebview.api.login(e,f,n,i),N=JSON.parse(g);"error"in N?m(N.error):(m(N.message),y(!0))})};return r.jsxs("div",{className:"flex flex-wrap items-center justify-start p-2 bg-gray-500 border border-white gap-7",children:[r.jsxs("div",{className:"flex items-center",children:[r.jsx("label",{htmlFor:"host",className:"mr-1 text-sm text-white whitespace-nowrap",children:"主機(H):"}),r.jsx("input",{type:"text",id:"host",className:"px-2 py-1 text-sm border border-gray-300 rounded w-28 focus:outline-none focus:ring-1 focus:ring-cyan-500",value:e,onChange:g=>t(g.target.value)})]}),r.jsxs("div",{className:"flex items-center",children:[r.jsx("label",{htmlFor:"username",className:"mr-1 text-sm text-white whitespace-nowrap",children:"使用者名稱(U):"}),r.jsx("input",{type:"text",id:"username",className:"px-2 py-1 text-sm border border-gray-300 rounded w-28 focus:outline-none focus:ring-1 focus:ring-cyan-500",value:n,onChange:g=>o(g.target.value)})]}),r.jsxs("div",{className:"flex items-center",children:[r.jsx("label",{htmlFor:"password",className:"mr-1 text-sm text-white whitespace-nowrap",children:"密碼(W):"}),r.jsx("input",{type:"password",id:"password",className:"px-2 py-1 text-sm border border-gray-300 rounded w-28 focus:outline-none focus:ring-1 focus:ring-cyan-500",value:i,onChange:g=>c(g.target.value)})]}),r.jsxs("div",{className:"flex items-center",children:[r.jsx("label",{htmlFor:"port",className:"mr-1 text-sm text-white whitespace-nowrap",children:"連接埠(P):"}),r.jsx("input",{type:"number",id:"port",className:"w-20 px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-cyan-500",value:f,onChange:g=>b(g.target.value)})]}),r.jsx("button",{className:"px-3 py-1 text-sm text-white bg-blue-600 rounded hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500",onClick:x,children:"快速連線(Q)"})]})},wt=()=>{const[e,t]=a.useState([]),n=a.useRef(null),{message:o}=K();return a.useEffect(()=>{t(i=>[...i,o])},[o]),a.useEffect(()=>{n.current&&(n.current.scrollTop=n.current.scrollHeight)},[e]),r.jsx("div",{ref:n,className:"w-full h-full p-2 overflow-auto bg-gray-500 border",style:{maxHeight:"400px"},children:r.jsx(Ce,{direction:"vertical",children:r.jsx(le,{dataSource:e,renderItem:(i,c)=>r.jsx(le.Item,{style:{paddingTop:"2px",paddingBottom:"2px"},children:r.jsx("div",{className:"flex items-center w-full h-full px-2 text-white",children:i})},c)})})})};function Pe(e){var t,n,o="";if(typeof e=="string"||typeof e=="number")o+=e;else if(typeof e=="object")if(Array.isArray(e))for(t=0;t<e.length;t++)e[t]&&(n=Pe(e[t]))&&(o&&(o+=" "),o+=n);else for(t in e)e[t]&&(o&&(o+=" "),o+=t);return o}function se(){for(var e,t,n=0,o="";n<arguments.length;)(e=arguments[n++])&&(t=Pe(e))&&(o&&(o+=" "),o+=t);return o}var Te=a.createContext({}),vt=()=>a.useContext(Te),xt=e=>V.createElement(Te.Provider,{...e});function yt(){let e=new Map;return{on(t,n){return e.has(t)?e.get(t).add(n):e.set(t,new Set([n])),this},off(t,n){return e.has(t)&&e.get(t).delete(n),this},emit(t,n){return e.has(t)&&e.get(t).forEach(o=>{o(n)}),this}}}var ce=yt(),bt=()=>a.useRef(new Map).current,jt=()=>{},ye=["resize","contextmenu","click","scroll","blur"],he={show({event:e,id:t,props:n,position:o}){e.preventDefault&&e.preventDefault(),ce.emit(0).emit(t,{event:e.nativeEvent||e,props:n,position:o})},hideAll(){ce.emit(0)}};function St(){let e=new Map,t,n,o,i,c=!1;function f(h){i=Array.from(h.values()),t=-1,o=!0}function b(){i[t].node.focus()}let y=()=>t>=0&&i[t].isSubmenu,m=()=>Array.from(i[t].submenuRefTracker.values());function x(){return t===-1?(g(),!1):!0}function g(){t+1<i.length?t++:t+1===i.length&&(t=0),c&&j(),b()}function N(){t===-1||t===0?t=i.length-1:t-1<i.length&&t--,c&&j(),b()}function _(){if(x()&&y()){let h=m(),{node:S,setSubmenuPosition:E}=i[t];return e.set(S,{isRoot:o,focusedIndex:t,parentNode:n||S,items:i}),E(),S.classList.add("contexify_submenu-isOpen"),n=S,h.length>0?(t=0,i=h):c=!0,o=!1,b(),!0}return!1}function j(){if(x()&&!o){let h=e.get(n);n.classList.remove("contexify_submenu-isOpen"),i=h.items,n=h.parentNode,h.isRoot&&(o=!0,e.clear()),c||(t=h.focusedIndex,b())}}function M(h){function S(E){for(let C of E)C.isSubmenu&&C.submenuRefTracker&&S(Array.from(C.submenuRefTracker.values())),C.keyMatcher&&C.keyMatcher(h)}S(i)}return{init:f,moveDown:g,moveUp:N,openSubmenu:_,closeSubmenu:j,matchKeys:M}}function ee(e){return typeof e=="function"}function be(e){return typeof e=="string"}function Nt(e,t){return a.Children.map(a.Children.toArray(e).filter(Boolean),n=>a.cloneElement(n,t))}function Ct(e){let t={x:e.clientX,y:e.clientY},n=e.changedTouches;return n&&(t.x=n[0].clientX,t.y=n[0].clientY),(!t.x||t.x<0)&&(t.x=0),(!t.y||t.y<0)&&(t.y=0),t}function je(e,t){return ee(e)?e(t):e}function Ot(e,t){return{...e,...ee(t)?t(e):t}}var Se=({id:e,theme:t,style:n,className:o,children:i,animation:c="fade",preventDefaultOnKeydown:f=!0,disableBoundariesCheck:b=!1,onVisibilityChange:y,...m})=>{let[x,g]=a.useReducer(Ot,{x:0,y:0,visible:!1,triggerEvent:{},propsFromTrigger:null,willLeave:!1}),N=a.useRef(null),_=bt(),[j]=a.useState(()=>St()),M=a.useRef(),h=a.useRef();a.useEffect(()=>(ce.on(e,E).on(0,C),()=>{ce.off(e,E).off(0,C)}),[e,c,b]),a.useEffect(()=>{x.visible?j.init(_):_.clear()},[x.visible,j,_]);function S(v,k){if(N.current&&!b){let{innerWidth:O,innerHeight:H}=window,{offsetWidth:I,offsetHeight:u}=N.current;v+I>O&&(v-=v+I-O),k+u>H&&(k-=k+u-H)}return{x:v,y:k}}a.useEffect(()=>{x.visible&&g(S(x.x,x.y))},[x.visible]),a.useEffect(()=>{function v(O){f&&O.preventDefault()}function k(O){switch(O.key){case"Enter":case" ":j.openSubmenu()||C();break;case"Escape":C();break;case"ArrowUp":v(O),j.moveUp();break;case"ArrowDown":v(O),j.moveDown();break;case"ArrowRight":v(O),j.openSubmenu();break;case"ArrowLeft":v(O),j.closeSubmenu();break;default:j.matchKeys(O);break}}if(x.visible){window.addEventListener("keydown",k);for(let O of ye)window.addEventListener(O,C)}return()=>{window.removeEventListener("keydown",k);for(let O of ye)window.removeEventListener(O,C)}},[x.visible,j,f]);function E({event:v,props:k,position:O}){v.stopPropagation();let H=O||Ct(v),{x:I,y:u}=S(H.x,H.y);fe.flushSync(()=>{g({visible:!0,willLeave:!1,x:I,y:u,triggerEvent:v,propsFromTrigger:k})}),clearTimeout(h.current),!M.current&&ee(y)&&(y(!0),M.current=!0)}function C(v){v!=null&&(v.button===2||v.ctrlKey)&&v.type!=="contextmenu"||(c&&(be(c)||"exit"in c&&c.exit)?g(k=>({willLeave:k.visible})):g(k=>({visible:k.visible?!1:k.visible})),h.current=setTimeout(()=>{ee(y)&&y(!1),M.current=!1}))}function R(){x.willLeave&&x.visible&&fe.flushSync(()=>g({visible:!1,willLeave:!1}))}function D(){return be(c)?se({[`contexify_willEnter-${c}`]:F&&!$,[`contexify_willLeave-${c} contexify_willLeave-'disabled'`]:F&&$}):c&&"enter"in c&&"exit"in c?se({[`contexify_willEnter-${c.enter}`]:c.enter&&F&&!$,[`contexify_willLeave-${c.exit} contexify_willLeave-'disabled'`]:c.exit&&F&&$}):null}let{visible:F,triggerEvent:w,propsFromTrigger:T,x:U,y:W,willLeave:$}=x,z=se("contexify",o,{[`contexify_theme-${t}`]:t},D());return V.createElement(xt,{value:_},F&&V.createElement("div",{...m,className:z,onAnimationEnd:R,style:{...n,left:U,top:W,opacity:1},ref:N,role:"menu"},Nt(i,{propsFromTrigger:T,triggerEvent:w})))},J=({id:e,children:t,className:n,style:o,triggerEvent:i,data:c,propsFromTrigger:f,keyMatcher:b,onClick:y=jt,disabled:m=!1,hidden:x=!1,closeOnClick:g=!0,handlerEvent:N="onClick",..._})=>{let j=a.useRef(),M=vt(),h={id:e,data:c,triggerEvent:i,props:f},S=je(m,h),E=je(x,h);function C(w){h.event=w,w.stopPropagation(),S||(g?R():y(h))}function R(){let w=j.current;w.focus(),w.addEventListener("animationend",()=>setTimeout(he.hideAll),{once:!0}),w.classList.add("contexify_item-feedback"),y(h)}function D(w){w&&!S&&(j.current=w,M.set(w,{node:w,isSubmenu:!1,keyMatcher:!S&&ee(b)&&(T=>{b(T)&&(T.stopPropagation(),T.preventDefault(),h.event=T,R())})}))}function F(w){(w.key==="Enter"||w.key===" ")&&(w.stopPropagation(),h.event=w,R())}return E?null:V.createElement("div",{..._,[N]:C,className:se("contexify_item",n,{"contexify_item-disabled":S}),style:o,onKeyDown:F,ref:D,tabIndex:-1,role:"menuitem","aria-disabled":S},V.createElement("div",{className:"contexify_itemContent"},t))};const{DirectoryTree:kt}=Ke,{Option:Et}=Oe,Ve=({initialTreeData:e=[{title:"根目錄",key:"root",children:void 0}],isLocal:t,onNodeSelect:n})=>{const[o,i]=a.useState(e),[c,f]=a.useState([]),[b,y]=a.useState(""),[m,x]=a.useState(null),[g,N]=a.useState([]),[_,j]=a.useState([]),[M,h]=a.useState(!1),[S,E]=a.useState(!1),[C,R]=a.useState(""),{setSendStatus:D,setFileTreeKey:F,setMessage:w,isLogining:T}=K(),U=s=>({fileMenuId:`file_menu_${s?"local":"remote"}`,folderMenuId:`folder_menu_${s?"local":"remote"}`}),W=async()=>{if(m){const s=G(o,m);if(s)try{const l=await window.pywebview.api.create_newFile(s.key,t),d=JSON.parse(l);if(console.log(d),d.error){console.error("Error:",d.error),w(d.error);return}F(p=>p+1)}catch(l){console.error("Failed to delete file:",l),w("刪除檔案失敗,詳細見控制台")}}},$=({nodeKey:s,onOpenFolder:l,nodeTitle:d,isLocal:p,menuId:Z,disableMenu:Y})=>r.jsxs(Se,{id:Z,children:[r.jsx(J,{onClick:()=>l(s),disabled:Y,children:"開啟資料夾"}),r.jsx(J,{onClick:W,disabled:Y,children:p?"新增檔案":"新增遠端檔案"}),r.jsx(J,{onClick:k,disabled:Y||d==="根目錄"||d==="遠端根目錄",children:"刪除資料夾"})]}),z=U(t);a.useEffect(()=>{f(t?["localStorage"]:["remoteStorage"])},[t]);const v=async(s,l,d,p)=>{const Z=l.key,Y=await window.pywebview.api.get_file_size(Z),re=JSON.parse(Y);if(re.error){w(re.error),console.error(re.error);return}const ze=`${re.size}`,ue=s==="上傳檔案"?"上傳":"下載";console.log(l.key);const pe=l.key.match(/[/\\]remoteStorage[/\\].+/);let me;pe&&(me=pe[0]);const Be=t?"":`${me}`;D(X=>[...X,{fileName:String(l.title),fileSize:ze,direction:ue,remotePath:Be,status:"傳送中"}]);try{s==="上傳檔案"?await window.pywebview.api.upload_file_to_remote(Z,d||""):s==="下載檔案"&&await window.pywebview.api.download_file_to_local(Z,p||"");const X=await window.pywebview.api.get_file_size(Z),ne=JSON.parse(X);if(ne.error)throw new Error(ne.error);D(B=>B.map(oe=>oe.fileName===String(l.title)&&oe.direction===ue?{...oe,status:"完成"}:oe)),F(B=>B+1)}catch(X){console.error("File action failed:",X),D(ne=>ne.map(B=>B.fileName===String(l.title)&&B.direction===ue?{...B,status:"失敗"}:B))}},k=async()=>{if(m){const s=G(o,m);if(s)try{const l=await window.pywebview.api.delete_file(s.key,t),d=JSON.parse(l);if(d.error){console.error("Error:",d.error),w(d.error);return}F(p=>p+1)}catch(l){console.error("Failed to delete file:",l),w("刪除檔案失敗,詳細見控制台")}}},O=async()=>{if(m){const s=G(o,m);if(s)try{const l=await window.pywebview.api.open_File(s.key,t),d=JSON.parse(l);if(d.error){console.error("Error:",d.error),w(d.error);return}}catch(l){console.error("Failed to open file:",l),w("開啟檔案失敗,詳細見控制台")}}},H=({isLocal:s,menuId:l,disableMenu:d})=>r.jsxs(Se,{id:l,children:[r.jsx(J,{onClick:O,disabled:d,children:"開啟檔案"}),r.jsx(J,{onClick:k,disabled:d,children:"刪除檔案"}),r.jsx(J,{onClick:()=>{console.log(s?"上傳":"下載"),s?L():te()},disabled:d,children:s?"上傳檔案":"下載檔案"})]}),I=(s,l,d)=>s.map(p=>p.key===l?{...p,children:d}:p.children?{...p,children:I(p.children,l,d)}:p),u=async()=>{try{const s=await window.pywebview.api.get_remote_folders(),l=s?JSON.parse(s):[];return l.error?(console.error("Error:",l.error),w(l.error),[]):l.folders||[]}catch(s){return console.error("Failed to fetch remote folders:",s),[]}},L=async()=>{if(!T){w("請先登入");return}const s=await u();N(s),h(!0)},P=async()=>{try{const s=await window.pywebview.api.get_local_folders(),l=s?JSON.parse(s):[];return l.error?(console.error("Error:",l.error),[]):(console.log("data",l.folders),l.folders||[])}catch(s){return console.error("Failed to fetch local folders:",s),[]}},te=async()=>{const s=await P();j(s),E(!0)},Re=async s=>{try{const l=await window.pywebview.api.get_local_children(s),d=JSON.parse(l);return d.error?(console.error("Error:",d.error),[]):!Array.isArray(d)||d.length===0?[{title:"無檔案",key:`${s}-empty`,isLeaf:!0}]:d.map(p=>({title:p.title,key:p.key,isLeaf:p.isLeaf,children:p.children||void 0}))}catch(l){return console.error("Failed to fetch local children:",l),[]}},De=async s=>{try{const l=await window.pywebview.api.get_server_children(s),d=JSON.parse(l);return d.error?(console.error("Error:",d.error),[]):!Array.isArray(d)||d.length===0?[{title:"無檔案",key:`${s}-empty`,isLeaf:!0}]:d.map(p=>({title:p.title,key:p.key,isLeaf:p.isLeaf,children:p.children||void 0}))}catch(l){return console.error("Failed to fetch remote children:",l),[]}},He=async({key:s,children:l})=>{if(l)return Promise.resolve();const d=t?await Re(s):await De(s);i(p=>I(p,s,d))},Ie=(s,l)=>{if(s.preventDefault(),String(l.key).includes("-empty")||l.children&&l.children.length===0)return;const d=typeof l.title=="string"?l.title:String(l.title);y(d),x(l.key);const p=l.children&&l.children.length===0;l.isLeaf?he.show({id:z.fileMenuId,event:s,props:{node:l,disableMenu:p}}):he.show({id:z.folderMenuId,event:s,props:{node:l,disableMenu:p}})},Ae=s=>{f(l=>[...l,s])},G=(s,l)=>{for(const d of s){if(d.key===l)return d;if(d.children){const p=G(d.children,l);if(p)return p}}return null},$e=async()=>{if(C&&m){const s=G(o,m);s&&(t?await v("上傳檔案",s,C,void 0):await v("下載檔案",s,"",C))}t?E(!1):h(!1)};return r.jsxs(r.Fragment,{children:[r.jsx(kt,{loadData:He,treeData:o,onSelect:(s,{node:l})=>n&&n(s[0],l),expandedKeys:c,onRightClick:({event:s,node:l})=>Ie(s,l),onExpand:s=>f(s)}),r.jsx(Ne,{title:"選擇目標資料夾",open:t?M:S,onOk:()=>{C&&$e(),h(!1),E(!1)},onCancel:()=>{h(!1),E(!1)},destroyOnClose:!0,children:r.jsx(Oe,{style:{width:"100%"},placeholder:"選擇資料夾",onChange:s=>R(s),value:C,children:(t?g:_).map(s=>r.jsx(Et,{value:s,children:s},s))})}),r.jsx(H,{isLocal:t,menuId:z.fileMenuId,disableMenu:!1}),m!==null&&r.jsx($,{nodeKey:m,onOpenFolder:Ae,nodeTitle:b,isLocal:t,menuId:z.folderMenuId,disableMenu:!1})]})},_t=(e,t)=>{console.log("Selected node key:",e)},Mt=()=>{const{localTreeData:e}=K();return r.jsx("div",{className:"h-full px-2 py-1 bg-gray-500 border-2 rounded",children:r.jsx(Ve,{onNodeSelect:_t,initialTreeData:e,isLocal:!0})})},Lt=(e,t)=>{console.log("Selected remote node key:",e)},Ft=()=>{const{isLogining:e,remoteTreeData:t}=K();return r.jsx("div",{className:"h-full px-2 py-1 bg-gray-500 border-2 rounded",children:e?r.jsx(Ve,{onNodeSelect:Lt,initialTreeData:t,isLocal:!1}):r.jsx(Ze,{description:"請先登入"})})},Pt=({localOpen:e,remoteOpen:t})=>r.jsxs("div",{className:"flex flex-row w-full h-full gap-2",children:[e&&r.jsx("div",{className:"flex-1",children:r.jsx(Mt,{})}),t&&r.jsx("div",{className:"flex-1",children:r.jsx(Ft,{})})]}),Tt=()=>{const{sendStatus:e}=K(),t=a.useRef(null);return console.log(e),a.useEffect(()=>{t.current&&t.current.scrollIntoView({behavior:"smooth"})},[e]),r.jsxs("div",{className:"box-border w-full h-full p-2 pb-4 bg-gray-500 border rounded",children:[r.jsxs("div",{className:"box-border grid grid-cols-5 gap-1 p-2 text-white bg-gray-600 border rounded",children:[r.jsx("div",{className:"col-span-1 truncate",children:"檔案名稱"}),r.jsx("div",{className:"col-span-1 truncate",children:"檔案大小/本地檔案"}),r.jsx("div",{className:"col-span-1 truncate",children:"方向"}),r.jsx("div",{className:"col-span-1 truncate",children:"遠端檔案"}),r.jsx("div",{className:"col-span-1 truncate",children:"狀態"})]}),r.jsx("div",{className:"overflow-y-auto",style:{maxHeight:"3.5rem"},children:e.map((n,o)=>r.jsxs("div",{ref:o===e.length-1?t:null,className:`grid grid-cols-5 gap-1 p-2 ${o%2===0?"bg-gray-400":"bg-gray-300"} border rounded box-border`,children:[r.jsx("div",{className:"col-span-1 truncate",children:n.fileName}),r.jsxs("div",{className:"col-span-1 truncate",children:[n.fileSize," "]}),r.jsx("div",{className:"col-span-1 truncate",children:n.direction}),r.jsx("div",{className:"col-span-1 truncate",children:n.remotePath}),r.jsx("div",{className:"col-span-1 truncate",children:n.status})]},o))})]})},Vt=()=>{const[e,t]=a.useState(!0),[n,o]=a.useState(!0),[i,c]=a.useState(!0),[f,b]=a.useState(!0),{fileTreeKey:y,setFileTreeKey:m}=K(),x=()=>{console.log("Reloading..."),m(M=>M+1)},g=()=>t(!e),N=()=>o(!n),_=()=>b(!f),j=()=>c(!i);return console.log(n,i),r.jsxs("div",{className:"grid grid-rows-[auto_auto_2fr_auto] h-screen min-w-full gap-1 p-2 bg-gray-700",children:[r.jsxs("div",{children:[r.jsx(mt,{handleReload:x,toggleConnectStatusOpen:g,toggleLocalFileListOpen:N,toggleRemoteFileListOpen:j,toggleSendStatusOpen:_}),r.jsx(gt,{})]}),e&&r.jsx("div",{className:"h-28",children:r.jsx(wt,{})}),(n||i)&&r.jsx("div",{className:"grid grid-cols-1 gap-1",children:r.jsx(Pt,{localOpen:n,remoteOpen:i},y)}),f&&r.jsx("div",{className:"h-28",children:r.jsx(Tt,{})})]})};_e(document.getElementById("root")).render(r.jsx(a.StrictMode,{children:r.jsx(pt,{children:r.jsx(Vt,{})})}));
